(function(){var f=devhd.pkg("control");var c=f.BaseControl.prototype;var i=f.createClass("TimelineControl",f.BaseControl);i.setTwitter=function(k){this.twitter=k};i.setPreferences=function(k){this.preferences=k};i.setDialog=function(k){this.dialog=k};i.setTinyURL=function(k){this.tinyURL=k};i.setSigns=function(k){this.signs=k};i.setMax=function(k){this.max=k
};i.destroy=function(){b.call(this);this.twitter=null;this.preferences=null;this.dialog=null;this.tinyURL=null;this.signs=null;c.destroy.call(this)};i.display=function(){this.part.innerHTML=templates.modules.loadingTimeline(this.home);var k=this;this.twitter.askTimeline(function(l){if(k.part==null){return}if(l==null){k.part.innerHTML=templates.modules.layoutTimelineLogin(l,k.home);
k.bind(k.element("tw_refresh"),"click",i.refresh);return}k.part.innerHTML=templates.modules.layoutTimeline(l,k.max||5,k.home);k.bind(k.element("tw_refresh"),"click",i.refresh);k.bind(k.element("tw_tweet"),"click",i.tweet);var m=k.part.getElementsByClassName("entry-meta");for(var n=0;n<m.length;n++){m[n].innerHTML=templates.modules.layoutTimelineActions(k.home);
m[n].style.display="inline";k.bind(m[n],"click",function(o){var p=o.target.parentNode.parentNode.parentNode.id;k.retweet(p)})}k.bind(k.element("timeline_selector"),"click",h);selectedSection=null;j.call(k,0)})};function h(l){var k=l.target;var m=k.getAttribute("data-section");if(m==null){return}j.call(this,m)}function j(k){if(selectedSection!=null){this.element("timeline_"+selectedSection).style.display="none";
this.element("timeline_"+selectedSection+"_selector").className="";selectedSection=null}this.element("timeline_"+k).style.display="block";this.element("timeline_"+k+"_selector").className="selected";selectedSection=k}var d=600;var g=0.5;var e=0.5;function a(){this.dialog.show("<div id='f'></div>",d,g,e);return this.part.ownerDocument.getElementById("f")
}function b(){if(this.shareControl==null){return}this.dialog.hide();this.shareControl.unregisterObserver(this);this.shareControl.destroy();this.shareControl=null}i.refresh=function(){try{this.display()}catch(k){that.part.style.display="none"}};i.tweet=function(){try{var k=this;this.home.askIncludeControl("twitter",function(){k.shareControl=new devhd.control.TwitterControl();
k.shareControl.setHome(k.home);k.shareControl.setSigns(k.signs);k.shareControl.setTwitter(k.twitter);k.shareControl.setTinyURL(k.tinyURL);k.shareControl.setPostfix("");k.shareControl.setPart(a.call(k));k.shareControl.setModel("message","");k.shareControl.registerObserver(k);k.shareControl.display()})}catch(l){$debug("[timeline][tweet] failed because:"+l.name+" -- "+l.message+" -- "+l.fileName+" -- "+l.lineNumber)
}};i.retweet=function(k){try{var l=this.element(k);if(l==null){return}var m=l.getElementsByClassName("screen-name")[0].innerHTML;var o=devhd.utils.StringUtils.stripTags(l.getElementsByClassName("entry-content")[0].innerHTML);var n=this;this.home.askIncludeControl("twitter",function(){n.shareControl=new devhd.control.TwitterControl();n.shareControl.setHome(n.home);
n.shareControl.setSigns(n.signs);n.shareControl.setTwitter(n.twitter);n.shareControl.setTinyURL(n.tinyURL);n.shareControl.setPostfix(n.preferences.get("twitterPostfix")||"");n.shareControl.setPart(a.call(n));n.shareControl.setModel("message","RT @"+m+" "+o);n.shareControl.registerObserver(n);n.shareControl.display()})}catch(p){$debug("[timeline][retweet] failed because:"+p.name+" -- "+p.message+" -- "+p.fileName+" -- "+p.lineNumber)
}};i.onControlDoneSending=function(k){b.call(this);if(k!=null&&this.signs!=null){this.signs.setMessage(k)}}})();