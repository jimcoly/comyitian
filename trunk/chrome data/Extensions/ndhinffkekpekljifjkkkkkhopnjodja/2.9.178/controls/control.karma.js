(function(){var d=devhd.pkg("control");var b=d.BaseControl.prototype;var e=d.createClass("KarmaControl",d.BaseControl);e.setTwitter=function(g){this.twitter=g};e.setTinyURL=function(g){this.tinyURL=g};e.setMax=function(g){this.max=g};e.destroy=function(){this.twitter=null;this.tinyURL=null;b.destroy.call(this)};e.display=function(){this.twitterId=this.twitter.getScreenName();
if(this.twitterId==null){this.part.style.display="none";return}var h=this;var g={q:"bit.ly",from:this.twitterId,filter:"links",rpp:this.max*2};this.twitter.askSearch(g,function(m){if(h.isDestroyed()||m==null){return}if(m.length==0){h.part.style.display="none";return}var l={};var j=[];for(var k=0;k<m.length&&j.length<h.max;k++){if(m[k].bitly==null||l[m[k].bitly]!=null){continue
}l[m[k].bitly]=true;j.push(m[k])}h.part.innerHTML=templates.control.karma.tweets(j);a.call(h,j)})};function a(l){var k=[[],[],[],[]];for(var h=0;h<l.length;h++){k[h%4].push(l[h])}for(var g=0;g<k.length;g++){c.call(this,k[g],g)}}function c(i,h){var g=this;devhd.utils.FlowUtils.forEach({},i,function(m,j,n,k,l){if(g.isDestroyed()){return}if(m.bitly==null){devhd.fn.callback(n)
}f.call(g,m,n,k,h,j)})}function f(l,m,k,j,g){var h=this;this.tinyURL.askStats(l.bitly,function(i){try{if(h.isDestroyed()){return}if(i.userClicks==null){h.element(l.bitly).style.display="none"}else{h.element(l.bitly+"_clicks").innerHTML=i.userClicks+" clicks"}}catch(n){}devhd.fn.callback(m)},function(i){try{if(h.isDestroyed()){return}h.element(l.bitly+"_clicks").innerHTML="?"
}catch(n){}devhd.fn.callback(m)});this.twitter.askSearch({q:"http://bit.ly/"+l.bitly,rpp:50},function(p){try{if(h.isDestroyed()){return}var n=[];for(var o=p.length-1;o>=0;o--){if(p[o].text.indexOf("http://bit.ly/"+l.bitly)>-1){n.push(p[o])}}if(n.length>1){h.element(l.bitly+"_rt").innerHTML=n.length+" RT"}}catch(q){}})}})();