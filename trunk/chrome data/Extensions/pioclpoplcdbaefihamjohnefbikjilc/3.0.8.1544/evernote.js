Evernote={insecureProto:"http://",secureProto:"https://",serviceDomain:"www.evernote.com",loginPath:"/jclip.action?login",logoutPath:"/jclip.action?logout",clipperPath:"/jclip.action?clip",syncStatePath:"/jclip.action?syncState",registrationPath:"/Registration.action",homePath:"/Home.action",fileNotePath:"/jclip.action?file",deleteNotePath:"/jclip.action?delete",findNotesPath:"/jclip.action?find",shardPath:"/shard",noteViewPath:"/view.jsp",extensionId:null,registrationCode:"jsclipper"};Evernote.getContext=function(){if(Evernote.context==null){Evernote.context=new EvernoteContext();}return Evernote.context;};function EvernoteContext(){this.__defineGetter__("tags",this.getTags);this.__defineSetter__("tags",this.setTags);this.__defineGetter__("searches",this.getSearches);this.__defineSetter__("searches",this.setSearches);this.__defineGetter__("notebooks",this.getNotebooks);this.__defineSetter__("notebooks",this.setNotebooks);this.__defineGetter__("defaultNotebook",this.getDefaultNotebook);this.__defineSetter__("defaultNotebook",this.setDefaultNotebook);this.__defineGetter__("syncState",this.getSyncState);this.__defineSetter__("syncState",this.setSyncState);this.__defineGetter__("user",this.getUser);this.__defineSetter__("user",this.setUser);this.__defineGetter__("noteFilter",this.getNoteFilter);this.__defineSetter__("noteFilter",this.setNoteFilter);this.__defineGetter__("remote",this.getRemote);this.__defineSetter__("remote",this.setRemote);this.__defineGetter__("shardId",this.getShardId);this.__defineGetter__("shardedUrl",this.getShardedUrl);this.__defineGetter__("store",this.getStore);this.__defineSetter__("store",this.setStore);this.__defineGetter__("insecureProto",this.getInsecureProto);this.__defineSetter__("insecureProto",this.setInsecureProto);this.__defineGetter__("secureProto",this.getSecureProto);this.__defineSetter__("secureProto",this.setSecureProto);this.__defineGetter__("serviceDomain",this.getServiceDomain);this.__defineSetter__("serviceDomain",this.setServiceDomain);this.__defineGetter__("extensionId",this.getExtensionId);this.__defineGetter__("extensionPath",this.getExtensionPath);this.__defineGetter__("options",this.getOptions);this.__defineSetter__("options",this.setOptions);this.__defineGetter__("state",this.getState);this.__defineSetter__("state",this.setState);this.__defineGetter__("autoSavedNote",this.getAutoSavedNote);this.__defineSetter__("autoSavedNote",this.setAutoSavedNote);this._remote=new EvernoteRemote();}EvernoteContext.prototype._store=null;EvernoteContext.prototype._tags=null;EvernoteContext.prototype._tagGuidMap=null;EvernoteContext.prototype._tagNameMap=null;EvernoteContext.prototype._notebookGuidMap=null;EvernoteContext.prototype._notebookNameMap=null;EvernoteContext.prototype._searches=null;EvernoteContext.prototype._notebooks=null;EvernoteContext.prototype._defaultNotebook=null;EvernoteContext.prototype._syncState=null;EvernoteContext.prototype._user=null;EvernoteContext.prototype._insecureProto=null;EvernoteContext.prototype._secureProto=null;EvernoteContext.prototype._serviceDomain=null;EvernoteContext.prototype._noteFilter=null;EvernoteContext.prototype._options=null;EvernoteContext.prototype._autoSavedNote=null;EvernoteContext.prototype.destroy=function(){this.tags=null;this.notebooks=null;this.searches=null;this.noteFilter=null;this.defaultNotebook=null;this.syncState=null;this.user=null;this.state=null;this.autoSavedNote=null;};EvernoteContext.PROTO_SUFFIX="://";EvernoteContext.isValidServiceProto=function(b){var a=new RegExp("^https?"+EvernoteContext.PROTO_SUFFIX+"$");return(typeof b=="string"&&b.match(a))?true:false;};EvernoteContext.formatServiceProto=function(b){if(typeof b=="string"){var a=new RegExp("("+EvernoteContext.PROTO_SUFFIX+")?$");return b.replace(/^\s+/,"").replace(/\s+$/,"").replace(a,EvernoteContext.PROTO_SUFFIX);}else{return b;}};EvernoteContext.prototype.setInsecureProto=function(a){var b=false;if(typeof a=="string"&&this._insecureProto!=a){a=EvernoteContext.formatServiceProto(a);if(EvernoteContext.isValidServiceProto(a)&&this._insecureProto!=a){this._insecureProto=a;b=true;}}else{if(a==null&&this._insecureProto!=null){this._insecureProto=null;b=true;}}if(b&&this.store){this.store.put("insecureProto",this._insecureProto);}};EvernoteContext.prototype.getInsecureProto=function(){if(this._insecureProto==null&&this.store){this._insecureProto=this.store.get("insecureProto");}return(this._insecureProto)?this._insecureProto:Evernote.insecureProto;};EvernoteContext.prototype.setSecureProto=function(a){var b=false;if(typeof a=="string"&&this._secureProto!=a){a=EvernoteContext.formatServiceProto(a);if(EvernoteContext.isValidServiceProto(a)&&this._secureProto!=a){this._secureProto=a;b=true;}}else{if(a==null&&this._secureProto!=null){this._secureProto=null;b=true;}}if(b&&this.store){this.store.put("secureProto",this._secureProto);}};EvernoteContext.prototype.getSecureProto=function(){if(this._secureProto==null&&this.store){this._secureProto=this.store.get("secureProto");}return(this._secureProto!=null)?this._secureProto:Evernote.secureProto;};EvernoteContext.prototype.setServiceDomain=function(a){var b=false;if(typeof a=="string"&&this._serviceDomain!=a){this._serviceDomain=a;b=true;}else{if(a==null&&this._serviceDomain!=null){this._serviceDomain=null;b=true;}}if(b&&this.store){this.store.put("serviceDomain",this._serviceDomain);}};EvernoteContext.prototype.getServiceDomain=function(){if(this._serviceDomain==null&&this.store){this._serviceDomain=this.store.get("serviceDomain");}return(this._serviceDomain!=null)?this._serviceDomain:Evernote.serviceDomain;};EvernoteContext.prototype.getServiceUrl=function(){return this.insecureProto+this.serviceDomain;};EvernoteContext.prototype.getSecureServiceUrl=function(){return this.secureProto+this.serviceDomain;};EvernoteContext.prototype.getLoginUrl=function(){return this.getSecureServiceUrl()+Evernote.loginPath;};EvernoteContext.prototype.getLogoutUrl=function(){return this.getSecureServiceUrl()+Evernote.logoutPath;};EvernoteContext.prototype.getRegistrationUrl=function(a){return this.getSecureServiceUrl()+Evernote.registrationPath+"?code="+Evernote.registrationCode;};EvernoteContext.prototype.getHomeUrl=function(){return this.getSecureServiceUrl()+Evernote.homePath;};EvernoteContext.prototype.getClipperUrl=function(){return this.getSecureServiceUrl()+Evernote.clipperPath;};EvernoteContext.prototype.getSyncStateUrl=function(){return this.getSecureServiceUrl()+Evernote.syncStatePath;};EvernoteContext.prototype.getFileNoteUrl=function(){return this.getSecureServiceUrl()+Evernote.fileNotePath;};EvernoteContext.prototype.getDeleteNoteUrl=function(){return this.getSecureServiceUrl()+Evernote.deleteNotePath;};EvernoteContext.prototype.getFindNotesUrl=function(){return this.getSecureServiceUrl()+Evernote.findNotesPath;};EvernoteContext.prototype.getShardId=function(){return(this.user instanceof User)?this.user.shardId:null;};EvernoteContext.prototype.getShardedUrl=function(){if(this.shardId){return this.getSecureServiceUrl()+Evernote.shardPath+"/"+this.shardId;}else{return null;}};EvernoteContext.prototype.getNoteViewUrl=function(a){if(this.shardId){return this.getSecureServiceUrl()+Evernote.noteViewPath+"?shard="+this.shardId+"#v=t&n="+a;}else{return null;}};EvernoteContext.prototype.getExtensionId=function(){if(Evernote.extensionId==null){var a=chrome.extension.getBackgroundPage().location.href;if(a){var b=a.replace(/^chrome-extension:\/\/([^\/]+).*$/,"$1");if(b!=null&&typeof b!="undefined"){Evernote.extensionId=b;}}}return Evernote.extensionId;};EvernoteContext.prototype.getExtensionPath=function(){return"chrome-extension://"+this.extensionId+"/";};EvernoteContext.prototype.isExtensionReleased=function(){return(typeof chrome.extension.getBackgroundPage().RELEASED!="undefined"&&chrome.extension.getBackgroundPage().RELEASED==true);};EvernoteContext.prototype.setRemote=function(a){if(a instanceof EvernoteRemote){this._remote=a;}};EvernoteContext.prototype.getRemote=function(){return this._remote;};EvernoteContext.prototype.setStore=function(a){if(a instanceof LocalStore){this._store=a;}else{if(a==null){this._store=null;}}};EvernoteContext.prototype.getStore=function(){return this._store;};EvernoteContext.prototype.isInSync=function(){return(this.getSyncState())?true:false;};EvernoteContext.prototype.setUser=function(a){var b=false;if(a instanceof User){this._user=a;b=true;}else{if(a==null){this._user=null;b=true;}}if(this.store&&b){if(this._user!=null){this.store.put("user",this._user);}else{this.store.remove("user");}}};EvernoteContext.prototype.getUser=function(){if(this._user==null&&this.store!=null){var a=this.store.get("user");if(a){this._user=new User(a);}}return this._user;};EvernoteContext.prototype.getTags=function(){if(this._tags==null&&this.store!=null){var b=this.store.get("tags");if(b&&typeof b.length=="number"){this._tags=new Array();for(var c=0;c<b.length;c++){var a=new Tag(b[c]);this._tags.push(a);}}}return this._tags;};EvernoteContext.prototype.setTags=function(a){var b=false;if(a==null){this._tags=null;b=true;}else{if(a instanceof Tag){this._tags=[a];b=true;}else{if(a instanceof Array){this._tags=a;b=true;}}}if(b){this._tagGuidMap=null;this._tagNameMap=null;}if(this.store&&b){if(this._tags){this.store.put("tags",this._tags);}else{this.store.remove("tags");}}};EvernoteContext.prototype.getTagNames=function(){var b=this.getTags();var a=new Array();if(b){for(var c=0;c<b.length;c++){a.push(b[c].name);}}return a;};EvernoteContext.prototype.getTagByGuid=function(a){var b=this.getTagGuidMap();if(typeof a=="string"&&typeof b[a]!="undefined"){return b[a];}return null;};EvernoteContext.prototype.getTagByName=function(a){if(typeof a=="string"){var b=this.getTagNameMap();return b[a.toLowerCase()];}return null;};EvernoteContext.prototype.getTagGuidMap=function(){if(this._tagGuidMap==null&&this.tags){this._tagGuidMap={};for(var a=0;a<this._tags.length;a++){this._tagGuidMap[this._tags[a].guid]=this._tags[a];}}return this._tagGuidMap;};EvernoteContext.prototype.getTagNameMap=function(){if(this._tagNameMap==null&&this.tags){this._tagNameMap={};for(var a=0;a<this._tags.length;a++){this._tagNameMap[this._tags[a].name.toLowerCase()]=this._tags[a];}}return this._tagNameMap;};EvernoteContext.prototype.getNotebooks=function(){if(this._notebooks==null&&this.store!=null){var b=this.store.get("notebooks");if(b&&typeof b.length=="number"){this._notebooks=new Array();for(var a=0;a<b.length;a++){this._notebooks.push(new Notebook(b[a]));}}}return this._notebooks;};EvernoteContext.prototype.setNotebooks=function(b){var a=false;if(b==null){this._notebooks=null;this._defaultNotebook=null;a=true;}else{if(b instanceof Notebook){this._notebooks=[b];this._defaultNotebook=null;a=true;}else{if(b instanceof Array){this._notebooks=this._sortModelsByField(b,"name");this._defaultNotebook=null;a=true;}}}if(a){this._notebookGuidMap=null;this._notebookNameMap=null;}if(this.store&&a){if(this._notebooks){this.store.put("notebooks",this._notebooks);}else{this.store.remove("notebooks");}}};EvernoteContext.prototype.getNotebookNames=function(){var c=this.getNotebooks();var b=new Array();if(c){for(var a=0;a<c.length;a++){b.push(c[a].name);}}return b;};EvernoteContext.prototype.getNotebookGuidMap=function(){if(this._notebookGuidMap==null&&this.notebooks){this._notebookGuidMap={};for(var a=0;a<this._notebooks.length;a++){this._notebookGuidMap[this._notebooks[a].guid]=this._notebooks[a];}}return this._notebookGuidMap;};EvernoteContext.prototype.getNotebookNameMap=function(){if(this._notebookNameMap==null&&this.notebooks){this._notebookNameMap={};for(var a=0;a<this._notebooks.length;a++){this._notebookNameMap[this._notebooks[a].name]=this._notebooks[a];}}return this._notebookNameMap;};EvernoteContext.prototype.getNotebookByGuid=function(a){if(typeof a=="string"){var b=this.getNotebookGuidMap();if(b){return b[a];}}return null;};EvernoteContext.prototype.getNotebookByName=function(a){if(typeof a=="string"){var b=this.getNotebookNameMap();if(b){return b[a];}}return null;};EvernoteContext.prototype.getDefaultNotebook=function(){if(this._defaultNotebook==null&&this._notebooks instanceof Array){for(var a=0;a<this._notebooks.length;a++){if(this._notebooks[a].defaultNotebook){this._defaultNotebook=this._notebooks[a];break;}}}return this._defaultNotebook;};EvernoteContext.prototype.setDefaultNotebook=function(a){if(a instanceof Notebook){this._defaultNotebook=a;}};EvernoteContext.prototype.getPreferredNotebook=function(){var a=null;if(this.options){if(this.options.clipNotebook==Options.CLIP_NOTEBOOK_OPTIONS.SELECT&&this.options.clipNotebookGuid&&this.getNotebookByGuid(this.options.clipNotebookGuid)){a=this.getNotebookByGuid(this.options.clipNotebookGuid);}else{if(this.options.clipNotebook==Options.CLIP_NOTEBOOK_OPTIONS.REMEMBER&&this.state&&this.state.notebookGuid&&this.getNotebookByGuid(this.state.notebookGuid)){a=this.getNotebookByGuid(this.state.notebookGuid);}}}return(a)?a:this.getDefaultNotebook();};EvernoteContext.prototype.setSearches=function(a){var b=false;if(a==null){this._searches=null;b=true;}else{if(a instanceof SavedSearch){this._searches=[a];b=true;}else{if(a instanceof Array){this._searches=a;b=true;}}}if(this.store&&b){if(this._searches){this.store.put("searches",this._searches);}else{this.store.remove("searches");}}};EvernoteContext.prototype.getSearches=function(){if(this._searches==null&&this.store!=null){var c=this.store.get("searches");if(c&&typeof c.length=="number"){this._searches=new Array();for(var b=0;b<c.length;b++){var a=new SavedSearch(c[b]);this._searches.push(a);}}}return this._searches;};EvernoteContext.prototype.setNoteFilter=function(a){var b=false;if(a instanceof NoteFilter){this._noteFilter=a;b=true;}else{if(a==null){this._noteFilter=null;b=true;}}if(b&&this.store){if(this._noteFilter){this.store.put("noteFilter",this._noteFilter);}else{this.store.remove("noteFilter");}}};EvernoteContext.prototype.getNoteFilter=function(){if(this._noteFilter==null&&this.store){var b=this.store.get("noteFilter");if(b){this._noteFilter=new NoteFilter(b);}}if(this._noteFilter==null){this._noteFilter=new NoteFilter();this._noteFilter.fuzzy=true;}var a=this.options.noteSortOrder;if(a){this._noteFilter.order=a.order;this._noteFilter.ascending=a.ascending;}return this._noteFilter;};EvernoteContext.prototype.getSyncState=function(){if(this._syncState==null&&this.store!=null){var a=this.store.get("syncState");if(a){this._syncState=new SyncState(a);}}return this._syncState;};EvernoteContext.prototype.setSyncState=function(a){if(a instanceof SyncState){this._syncState=a;if(this.store){this.store.put("syncState",this._syncState);}}else{if(a==null){this._syncState=null;if(this.store){this.store.remove("syncState");}}}};EvernoteContext.prototype.processSyncChunk=function(a){if(a instanceof SyncChunk){if(a.expungedNotebooks.length>0){if(typeof LOG!="undefined"){LOG.debug("Expunging "+a.expungedNotebooks.length+" notebooks");}this.notebooks=this._expungeModels(this.notebooks,a.expungedNotebooks);if(typeof LOG!="undefined"){LOG.debug("Now we have "+this.notebooks.length+" notebooks");}}if(a.notebooks.length>0){if(typeof LOG!="undefined"){LOG.debug("Merging "+a.notebooks.length+" notebooks");}this.notebooks=this._mergeModels(this.notebooks,a.notebooks);if(typeof LOG!="undefined"){LOG.debug("Now we have "+this.notebooks.length+" notebooks");}}if(a.expungedTags.length>0){if(typeof LOG!="undefined"){LOG.debug("Expunging "+a.expungedTags.length+" tags");}this.tags=this._expungeModels(this.tags,a.expungedTags);if(typeof LOG!="undefined"){LOG.debug("Now we have "+this.tags.length+" tags");}}if(a.tags.length>0){if(typeof LOG!="undefined"){LOG.debug("Merging "+a.tags.length+" tags");}this.tags=this._mergeModels(this.tags,a.tags);if(typeof LOG!="undefined"){LOG.debug("Now we have "+this.tags.length+" tags");}}if(a.chunkHighUSN>0&&this.syncState){this.syncState.updateCount=a.chunkHighUSN;if(a.currentTime){this.syncState.currentTime=a.currentTime;}}}};EvernoteContext.prototype.resetSyncState=function(){if(typeof LOG!="undefined"){LOG.debug("Resetting syncState");}if(this._syncState!=null){this.setSyncState(null);this.setUser(null);this.setTags(null);this.setNotebooks(null);this.setDefaultNotebook(null);}};EvernoteContext.prototype.setOptions=function(a){var b=false;if(a instanceof Options){this._options=a;b=true;}else{if(a==null){this._options=null;b=true;}}if(b&&this.store){if(this.options){this.store.put("options",this._options);}else{this.store.remove("options");}}};EvernoteContext.prototype.getOptions=function(){if(this._options==null&&this.store){var a=this.store.get("options");if(a){this._options=new Options(this,a);}}if(this._options==null){this._options=new Options(this,{secureProto:this.secureProto,insecureProto:this.insecureProto,serviceDomain:this.serviceDomain});}this._options.developerMode=!this.isExtensionReleased();return this._options;};EvernoteContext.prototype.setState=function(a){var b=false;if(a instanceof AppState){this._state=a;b=true;}else{if(a==null){this._state=null;b=true;}}if(b&&this.store){if(this._state){this.store.put("state",this._state);}else{this.store.remove("state");}}};EvernoteContext.prototype.getState=function(){if(this._state==null&&this.store){var a=this.store.get("state");if(a){this._state=new AppState(a);}}if(this._state==null){this._state=new AppState();}return this._state;};EvernoteContext.prototype.setAutoSavedNote=function(a){var b=false;if(a instanceof ClipNote){this._autoSavedNote=a;b=true;}else{if(a==null){this._autoSavedNote=null;b=true;}}if(b&&this.store){if(this._autoSavedNote){this.store.put("autoSavedNote",this._autoSavedNote);}else{this.store.remove("autoSavedNote");}}};EvernoteContext.prototype.getAutoSavedNote=function(){if(this._autoSavedNote==null&&this.store){var a=this.store.get("autoSavedNote");if(a){this._autoSavedNote=new ClipNote(a);}}return this._autoSavedNote;};EvernoteContext.prototype._expungeModels=function(e,d){if(e instanceof Array&&d instanceof Array){var b={};var a=new Array();for(var c=0;c<d.length;c++){if(typeof LOG!="undefined"){LOG.debug("Adding guid: "+d[c]);}b[d[c]]=d[c];}for(var c=0;c<e.length;c++){if(typeof LOG!="undefined"){LOG.debug("Checking if we have: "+e[c].guid);}if(typeof b[e[c].guid]=="undefined"){if(typeof LOG!="undefined"){LOG.debug("No we don't, keeping then...");}a.push(e[c]);}}if(typeof LOG!="undefined"){LOG.debug("Expunged "+(e.length-a.length)+" models");}return a;}if(typeof LOG!="undefined"){LOG.warn("There was nothing to expunge");}return e;};EvernoteContext.prototype._mergeModels=function(g,b){if(g instanceof Array&&b instanceof Array){var f={};var a=new Array();for(var e=0;e<b.length;e++){if(typeof b[e]["guid"]!="undefined"){f[b[e].guid]=b[e];}}var h=0;var d=0;var c=0;for(var e=0;e<g.length;e++){if(typeof f[g[e].guid]!="undefined"){c++;a.push(f[g[e].guid]);delete f[g[e].guid];}else{d++;a.push(g[e]);}}for(var e in f){h++;a.push(f[e]);}if(typeof LOG!="undefined"){LOG.debug("Updated "+c+" models; Kept "+d+" models; Added: "+h);}return a;}else{if(b instanceof Array){if(typeof LOG!="undefined"){LOG.warn("There were no models to merge into");}return b;}}if(typeof LOG!="undefined"){LOG.warn("There were no models to merge");}return g;};EvernoteContext.prototype._sortModelsByField=function(b,a){if(b instanceof Array){return b.sort(function(d,c){var f="";var e="";if(typeof d[a]!="undefined"){f=d[a].toLowerCase();}if(typeof c[a]!="undefined"){e=c[a].toLowerCase();}if(f==e){return 0;}else{if(f<e){return -1;}else{return 1;}}});}return b;};EvernoteContext.prototype._sortModels2=function(g,e){if(g instanceof Array&&typeof e=="string"){var b=new Array();var f={};var a=new Array();for(var d=0;d<g.length;d++){if(typeof g[e]!="undefined"){b.push(g[d][e]+"_"+g[d].guid);f[g[d].guid]=g[d];}}b.sort();for(var d=0;d<b.length;d++){var c=b[d].replace(/^.*_([^_]+)$/,"$1");if(c&&typeof f[c]!="undefined"){a.push(f[c]);}}return a;}return g;};function EvernoteRemote(){this.marshallData=null;this.unmarshallData=null;}EvernoteRemote.CLASS_IDENTIFIER="javaClass";EvernoteRemote.RESPONSE_ERROR_KEY="errors";EvernoteRemote.RESPONSE_RESULT_KEY="result";EvernoteRemote.prototype.setDataMarshaller=function(a){this.marshallData=a;};EvernoteRemote.prototype.setDataUnmarshaller=function(a){this.unmarshallData=a;};EvernoteRemote.prototype.authenticate=function(g,b,f,e,a,d){if(typeof LOG!="undefined"){LOG.debug("EvernoteRemote.authenticate");}f=(typeof f=="undefined"||!(f))?false:true;var c={username:g,password:b,rememberMe:f};return this.getJson(Evernote.getContext().getLoginUrl(),c,e,a,d);};EvernoteRemote.prototype.logout=function(c,a,b){if(typeof LOG!="undefined"){LOG.debug("EvernoteRemote.logout");}return this.getJson(Evernote.getContext().getLogoutUrl(),{},c,a,b);};EvernoteRemote.prototype.getSyncState=function(a,g,b,f){if(typeof LOG!="undefined"){LOG.debug("EvernoteRemote.getSyncState");}a=parseInt(a);var c={};if(a>0){c.updateCount=a;}try{if(typeof LOG!="undefined"){LOG.debug("Get: "+Evernote.getContext().getSyncStateUrl()+"&"+((c)?JSON.stringify(c).replace(/,/g,"&"):""));}}catch(d){}return this.getJson(Evernote.getContext().getSyncStateUrl(),c,g,b,f);};EvernoteRemote.prototype.clip=function(b,e,a,d){if(typeof LOG!="undefined"){LOG.debug("EvernoteRemote.clip");}var c=null;if(b instanceof ClipNote){c=b.toStorable();}else{if(typeof b=="object"&&b!=null){if(typeof LOG!="undefined"){LOG.warn("Passed object was not a ClipNote... trying to make one");}c=(new ClipNote(b)).toStorable();}}return this.postJson(Evernote.getContext().getClipperUrl(),c,e,a,d,true);};EvernoteRemote.prototype.file=function(c,f,b,e){if(typeof LOG!="undefined"){LOG.debug("EvernoteRemote.fileNote");}var d={};if(c instanceof Note){if(c.guid){d.noteGuid=c.guid;}if(c.title){d.title=c.title;}if(c.comment){d.comment=c.comment;}if(c.notebookGuid){d.notebookGuid=c.notebookGuid;}var a=c.getTagNamesAsString();if(a!=null&&a.length>0){d.tagNames=a;}}return this.postJson(Evernote.getContext().getFileNoteUrl(),d,f,b,e);};EvernoteRemote.prototype.deleteNote=function(b,e,a,d){if(typeof LOG!="undefined"){LOG.debug("EvernoteRemote.deleteNote");}var c={};if(b instanceof Note){if(b.guid){c.noteGuid=b.guid;}}return this.postJson(Evernote.getContext().getDeleteNoteUrl(),c,e,a,d);};EvernoteRemote.prototype.findNotes=function(g,c,b,j,a,h){if(typeof LOG!="undefined"){LOG.debug("EvernoteRemote.findNotes");}var f={offset:parseInt(c),maxNotes:parseInt(b)};if(g instanceof NoteFilter){var d=g.toStorable();for(var e in d){if(typeof d[e]!="undefined"&&d[e]!=null){f["noteFilter."+e]=d[e];}}}return this.postJson(Evernote.getContext().getFindNotesUrl(),f,j,a,h);};EvernoteRemote.prototype.postJson=function(c,d,f,b,e,a){return this.doRequest("POST","json",c,d,f,b,e,a);};EvernoteRemote.prototype.getJson=function(b,c,e,a,d){return this.doRequest("GET","json",b,c,e,a,d);};EvernoteRemote.prototype.doRequest=function(i,n,d,s,g,j,h,l){if(i==null){i="GET";}var k=this;var b=null;var c=null;var m=Evernote.getContext().getSyncState();var t=Evernote.getContext().getUser();if(m instanceof SyncState&&m.updateCount&&typeof s.updateCount=="undefined"){s.updateCount=m.updateCount;}if(t instanceof User&&typeof t.username=="string"){s.username=t.username;}if(typeof LOG!="undefined"){var r="";try{r=JSON.stringify(s).replace(/\"password\":\"[^\"]+\"/,'"password":"******"');}catch(q){}LOG.debug("doRequest("+i+", "+n+", "+d+", "+r+")");}var f=function(u,v,e){if(typeof LOG!="undefined"){LOG.debug("EvernoteRemote.doRequest failed response");}if(h){k.handleHttpError(u,v,e);}if(typeof j=="function"){j(u,v,e);}};var p=function(u,w,v){if(v.status==0){return f(v,w,u);}if(typeof LOG!="undefined"){LOG.debug("EvernoteRemote.doRequest successfull response");}var e=u;if(h){e=k.handleHttpSuccess(u,w,v);}if(typeof g=="function"){g(e,w,v);}};var o={url:d,async:true,cache:false,data:s,dataType:n,error:f,success:p,type:i};if(l&&i=="POST"){var a=new EvernoteMultiPartForm(s);o.contentType=a.getContentTypeHeader();o.data=a.toString();}return $.ajax(o);};EvernoteRemote.prototype.handleHttpSuccess=function(c,h,g){if(typeof LOG!="undefined"){LOG.debug("EvernoteRemote.handleHttpSuccess");}var b=this;try{var a=EDAMResponse.createFrom(c,function(e){if(e!=null&&typeof b.unmarshallData=="function"){if(typeof LOG!="undefined"){LOG.debug("Unmarshalling result");}e=b.unmarshallData(e);}else{if(typeof LOG!="undefined"){LOG.debug("Cannot unmarshall result");}}return e;});}catch(d){var f="";if(d instanceof EvernoteError){f=d.errorCode;}else{if(d instanceof Error){f=d.message;}}if(typeof LOG!="undefined"){LOG.debug("Exception creating EDAMResponse: "+f);}var a=new EDAMResponse();a.addError(d);}if(typeof LOG!="undefined"){LOG.debug("HTTP ["+g.status+", "+h+"] Type: "+a.type);}return a;};EvernoteRemote.prototype.handleHttpError=function(b,c,a){if(typeof LOG!="undefined"){LOG.debug("HTTP ["+b.status+","+c+"] "+a);}};EvernoteRemote.prototype.validateEDAMResponse=function(a,b){if(typeof LOG!="undefined"){LOG.debug("EvernoteRemote.validateEDAMResponse");}if(a&&typeof a=="object"){return(typeof a[EvernoteRemote.RESPONSE_RESULT_KEY]=="object"&&a[EvernoteRemote.RESPONSE_RESULT_KEY]!=null);}else{if(typeof LOG!="undefined"){LOG.debug("Invalid response from jclipper...");}throw new Error(EDAMResponseErrorCode.INVALID_RESPONSE);}};function EvernoteMultiPartForm(a){this.__defineGetter__("data",this.getData);this.__defineSetter__("data",this.setData);this.initialize(a);}EvernoteMultiPartForm.CONTENT_TYPE="multipart/form-data";EvernoteMultiPartForm.BOUNDARY_MARK="--";EvernoteMultiPartForm.BOUNDARY_PREFIX="----EvernoteFormBoundary";EvernoteMultiPartForm.HEADER_SEPARATOR="; ";EvernoteMultiPartForm.HEADER_BOUNDARY="boundary";EvernoteMultiPartForm.CR="\r\n";EvernoteMultiPartForm.createBoundary=function(){return this.BOUNDARY_PREFIX+(new Date().getTime());};EvernoteMultiPartForm.prototype._data=null;EvernoteMultiPartForm.prototype.boundary=null;EvernoteMultiPartForm.prototype.initialize=function(a){this.boundary=this.constructor.createBoundary();this.data=a;};EvernoteMultiPartForm.prototype.setData=function(a){if(typeof a=="object"){this._data=a;}};EvernoteMultiPartForm.prototype.getData=function(){return this._data;};EvernoteMultiPartForm.prototype.getContentTypeHeader=function(){return this.constructor.CONTENT_TYPE+this.constructor.HEADER_SEPARATOR+this.constructor.HEADER_BOUNDARY+"="+this.boundary;};EvernoteMultiPartForm.prototype.toJSON=function(){return{contentType:this.getContentTypeHeader(),boundary:this.boundary,data:this.data};};EvernoteMultiPartForm.prototype.toString=function(){var b="";if(this._data){for(var a in this._data){if(this._data[a]==null||(this._data[a]+"").length==0){continue;}b+=this.constructor.BOUNDARY_MARK+this.boundary+this.constructor.CR;b+=(new EvernoteFormPart({name:a,data:this._data[a]})).toString();b+=this.constructor.CR;}}b+=this.constructor.BOUNDARY_MARK+this.boundary+this.constructor.BOUNDARY_MARK+this.constructor.CR;return b;};function EvernoteFormPart(a){this.__defineGetter__("name",this.getName);this.__defineSetter__("name",this.setName);this.__defineGetter__("data",this.getData);this.__defineSetter__("data",this.setData);this.initialize(a);}EvernoteFormPart.HEADER_CONTENT_DISPOSITION="Content-Disposition: ";EvernoteFormPart.HEADER_FORM_DATA="form-data";EvernoteFormPart.HEADER_SEPARATOR="; ";EvernoteFormPart.HEADER_KEYVAL_SEPARATOR="=";EvernoteFormPart.HEADER_NAME="name";EvernoteFormPart.CR="\r\n";EvernoteFormPart.prototype._name=null;EvernoteFormPart.prototype._data=null;EvernoteFormPart.prototype.initialize=function(a){if(typeof a=="object"&&a!=null){this.name=(typeof a.name!="undefined")?a.name:null;this.data=(typeof a.data!="undefined")?a.data:null;}};EvernoteFormPart.prototype.getHeader=function(){return this.constructor.HEADER_CONTENT_DISPOSITION+this.constructor.HEADER_FORM_DATA+this.constructor.HEADER_SEPARATOR+this.constructor.HEADER_NAME+this.constructor.HEADER_KEYVAL_SEPARATOR+'"'+this.name+'"';};EvernoteFormPart.prototype.setName=function(a){if(a==null){this._name=null;}else{this._name=a+"";}};EvernoteFormPart.prototype.getName=function(){return this._name;};EvernoteFormPart.prototype.setData=function(a){if(a==null){this._data=null;}else{this._data=a+"";}};EvernoteFormPart.prototype.getData=function(){return this._data;};EvernoteFormPart.prototype.toJSON=function(){return{name:this.name,data:this.data};};EvernoteFormPart.prototype.toString=function(){return this.getHeader()+this.constructor.CR+this.constructor.CR+(this.data+"");};function EDAMResponse(a){this.__defineGetter__("errors",this.getErrors);this.__defineSetter__("errors",this.setErrors);this.__defineGetter__("result",this.getResult);this.__defineSetter__("result",this.setResult);this.__defineGetter__("type",this.getType);this.__defineSetter__("type",this.setType);this.initialize(a);}EDAMResponse.TYPE_UNKNOWN=0;EDAMResponse.TYPE_ERROR=1;EDAMResponse.TYPE_TEXT=2;EDAMResponse.TYPE_HTML=3;EDAMResponse.TYPE_OBJECT=4;EDAMResponse.prototype._result=null;EDAMResponse.prototype._errors=null;EDAMResponse.prototype._type=EDAMResponse.TYPE_UNKNOWN;EDAMResponse.prototype.initialize=function(a){if(typeof a=="object"&&typeof a[EvernoteRemote.RESPONSE_ERROR_KEY]!="undefined"){this.errors=a[EvernoteRemote.RESPONSE_ERROR_KEY];}else{if(typeof a=="object"&&typeof a[EvernoteRemote.RESPONSE_RESULT_KEY]!="undefined"){this.result=a[EvernoteRemote.RESPONSE_RESULT_KEY];}}};EDAMResponse.prototype.isEmpty=function(){return(this.result==null&&this.errors==null);};EDAMResponse.prototype.isError=function(){return(this.errors!=null);};EDAMResponse.prototype.isResult=function(){return(this.result!=null);};EDAMResponse.prototype.addError=function(a){if(this._errors==null){this._errors=new Array();}this._errors.push(a);};EDAMResponse.prototype.setErrors=function(a){if(a==null||typeof a=="undefined"){this._errors=null;}else{this._errors=(a instanceof Array)?a:[a];}};EDAMResponse.prototype.getErrors=function(){return this._errors;};EDAMResponse.prototype.hasValidationErrors=function(){return this.hasErrorClass(ValidationError);};EDAMResponse.prototype.hasExceptions=function(){return this.hasErrorClass(Exception);};EDAMResponse.prototype.hasErrorClass=function(b){if(this.isError()){for(var a=0;a<this.errors.length;a++){if(this._errors[a] instanceof b){return true;}}}return false;};EDAMResponse.prototype.hasErrorCode=function(b){if(this.isError()){for(var a=0;a<this._errors.length;a++){if(this._errors[a].errorCode==b){return true;}}}return false;};EDAMResponse.prototype.getErrorsByCode=function(b,a){return this.getErrorsByField(Exception.ERROR_CODE_FIELD,b,a);};EDAMResponse.prototype.getErrorsByClass=function(b,a){return this.getErrorsByField(Exception.CLASS_FIELD,(typeof b=="string")?b:b[Exception.CLASS_FIELD],a);};EDAMResponse.prototype.getErrorsByField=function(e,d,a){var c=new Array();if(this.isError()){for(var b=0;b<this._errors.length;b++){if(typeof this._errors[b][e]!="undefined"&&this._errors[b][e]==d){c.push(this._errors[b]);if(typeof a=="number"&&c.length>=a){break;}}}}return(c.length==0)?null:c;};EDAMResponse.prototype.selectErrors=function(c){var b=new Array();if(typeof c=="function"&&this.isError()){for(var a=0;a<this._errors.length;a++){if(c(this._errors[a])){b.push(this._errors[a]);}}}return(b.length==0)?null:b;};EDAMResponse.prototype.getResult=function(){return this._result;};EDAMResponse.prototype.setResult=function(a){this._result=a;};EDAMResponse.prototype.getType=function(){return this._type;};EDAMResponse.prototype.setType=function(a){this._type=parseInt(a);};EDAMResponse.prototype.toString=function(){return"EDAMResponse ("+this.type+") "+((this.isError())?"ERROR":"RESULT");};EDAMResponse.createFrom=function(f,c){if(typeof LOG!="undefined"){LOG.debug("EDAMResponse.createFrom");}var b=new EDAMResponse();if(typeof f[EvernoteRemote.RESPONSE_ERROR_KEY]=="object"&&f[EvernoteRemote.RESPONSE_ERROR_KEY]!=null){var h=(f[EvernoteRemote.RESPONSE_ERROR_KEY] instanceof Array)?f[EvernoteRemote.RESPONSE_ERROR_KEY]:[f[EvernoteRemote.RESPONSE_ERROR_KEY]];for(var d=0;d<h.length;d++){if(typeof h[d]=="object"&&typeof h[d][EvernoteRemote.CLASS_IDENTIFIER]=="string"){var a=EvernoteError.responsibleConstructor(h[d][EvernoteRemote.CLASS_IDENTIFIER]);if(typeof a=="function"){var g=new a(h[d]);if(typeof LOG!="undefined"){LOG.debug("Classifiable error: "+g.toString());}b.addError(g);}else{if(typeof LOG!="undefined"){LOG.debug("Generic error");}b.addError(new Exception(h[d]));}}else{if(typeof h[d]=="object"){if(typeof LOG!="undefined"){LOG.debug("Non-classifiable exception");}b.addError(new Exception(h[d]));}else{if(h[d]!=null){if(typeof LOG!="undefined"){LOG.debug("Non-classifiable error");}b.addError(new Error(h[d]));}}}}b.type=EDAMResponse.TYPE_ERROR;}else{if((typeof f[EvernoteRemote.RESPONSE_RESULT_KEY]=="object"&&f[EvernoteRemote.RESPONSE_RESULT_KEY]!=null)||typeof f[EvernoteRemote.RESPONSE_RESULT_KEY]=="string"||typeof f[EvernoteRemote.RESPONSE_RESULT_KEY]=="number"||typeof f[EvernoteRemote.RESPONSE_RESULT_KEY]=="boolean"){if(typeof c=="function"){if(typeof LOG!="undefined"){LOG.debug("Transforming and setting response result");}b.result=c(f[EvernoteRemote.RESPONSE_RESULT_KEY]);}else{if(typeof LOG!="undefined"){LOG.debug("Setting response result as-is");}b.result=f[EvernoteRemote.RESPONSE_RESULT_KEY];}if(typeof b.result=="object"&&b.result!=null){b.type=EDAMResponse.TYPE_OBJECT;}else{if(typeof b.result=="string"&&b.result.match(/<[^>]+>/)){b.type=EDAMResponse.TYPE_HTML;}else{if(typeof b.result!=null){b.type=EDAMResponse.TYPE_TEXT;}}}}else{if(typeof LOG!="undefined"){LOG.debug("Invalid response data");}LOG.debug(">>> "+JSON.stringify(f));throw new EDAMResponseException(EDAMResponseErrorCode.INVALID_RESPONSE);}}return b;};EDAMErrorCode={UNKNOWN:1,BAD_DATA_FORMAT:2,PERMISSION_DENIED:3,INTERNAL_ERROR:4,DATA_REQUIRED:5,LIMIT_REACHED:6,QUOTA_REACHED:7,INVALID_AUTH:8,AUTH_EXPIRED:9,DATA_CONFLICT:10,ENML_VALIDATION:11,SHARD_UNAVAILABLE:12};EDAMResponseErrorCode={UNKNOWN:1,INVALID_RESPONSE:2};function EvernoteError(a,b,c){this.__defineGetter__("errorCode",this.getErrorCode);this.__defineSetter__("errorCode",this.setErrorCode);this.__defineGetter__("modelName",this.getModelName);this.initialize(a,b,c);}EvernoteError.CLASS_FIELD="javaClass";EvernoteError.ERROR_CODE_FIELD="errorCode";EvernoteError.MESSAGE_FIELD="message";EvernoteError.PARAMETER_FIELD="parameter";EvernoteError.javaClass="com.evernote.web.EvernoteError";EvernoteError.prototype._modelName=null;EvernoteError.prototype._errorCode=null;EvernoteError.prototype.message=null;EvernoteError.prototype.parameter=null;EvernoteError.prototype.handleInheritance=function(){if(typeof this.prototype.constructor[EvernoteError.CLASS_FIELD]=="string"){EvernoteError.Registry[this.prototype.constructor[EvernoteError.CLASS_FIELD]]=this;}this.prototype.constructor.modelName=this.prototype.constructor.toString().replace(/\n/g,"").replace(/^.*function\s+([^\(]+).*$/,"$1");};EvernoteError.prototype.getModelName=function(){return this.constructor.toString().replace(/\n/g,"").replace(/^.*function\s+([^\(]+).*$/,"$1");};EvernoteError.prototype.initialize=function(a,b,c){if(a&&typeof a=="object"){if(typeof a[EvernoteError.ERROR_CODE_FIELD]!="undefined"){this.errorCode=a[EvernoteError.ERROR_CODE_FIELD];}if(typeof a[EvernoteError.MESSAGE_FIELD]!="undefined"){this.message=a[EvernoteError.MESSAGE_FIELD];}if(typeof a[EvernoteError.PARAMETER_FIELD]!="undefined"){this.parameter=a[EvernoteError.PARAMETER_FIELD];}}else{if(typeof a!="undefined"){this.errorCode=a;}if(typeof b!="undefined"){this.message=b;}if(typeof c!="undefined"){this.parameter=c;}}this.constructor.modelName=this.modelName;};EvernoteError.prototype.setErrorCode=function(a){this._errorCode=(isNaN(parseInt(a)))?null:parseInt(a);};EvernoteError.prototype.getErrorCode=function(){return this._errorCode;};EvernoteError.prototype.getClassName=function(){return(typeof this.constructor[EvernoteError.CLASS_FIELD]!="undefined")?this.constructor[EvernoteError.CLASS_FIELD]:null;};EvernoteError.prototype.getShortClassName=function(){var a=this.getClassName();if(typeof a=="string"){var b=a.split(".");a=b[b.length-1];}return a;};EvernoteError.prototype.toString=function(){var a=this.getShortClassName();if(a==null){return"EvernoteError";}return(a+" ("+this.errorCode+") ["+this.parameter+"]"+((typeof this.message=="string")?this.message:""));};EvernoteError.Registry={};EvernoteError.responsibleConstructor=function(a){if(typeof LOG!="undefined"){LOG.debug("Exception.responsibleConstructor");}if(typeof EvernoteError.Registry[a]=="function"){return EvernoteError.Registry[a];}else{return EvernoteError;}};function Exception(a,b){this.initialize(a,b,null);}Exception.javaClass="java.lang.Exception";Exception.inherit(EvernoteError);Exception.prototype._errorCode=EDAMErrorCode.UNKNOWN;function EDAMSystemException(a,b){this.initialize(a,b);}EDAMSystemException.javaClass="com.evernote.edam.error.EDAMSystemException";EDAMSystemException.inherit(Exception);function EDAMUserException(a,b,c){this.initialize(a,b,c);}EDAMUserException.javaClass="com.evernote.edam.error.EDAMUserException";EDAMUserException.inherit(Exception);function EDAMResponseException(a,b){this.initialize(a,b);}EDAMResponseException.javaClass="com.evernote.edam.error.EDAMResponseException";EDAMResponseException.inherit(EvernoteError);function ValidationError(a,b,c){this.initialize(a,b,c);}ValidationError.GLOBAL_PARAMETER="__stripes_global_error";ValidationError.javaClass="net.sourceforge.stripes.validation.ValidationError";ValidationError.inherit(EvernoteError);ValidationError.prototype.isGlobal=function(){return(this.parameter==null||this.parameter==ValidationError.GLOBAL_PARAMETER);};function SimpleError(a){this.initialize(null,a,null);}SimpleError.javaClass="net.sourceforge.stripes.validation.SimpleError";SimpleError.inherit(ValidationError);function ScopedLocalizableError(a,b,c){this.initialize(a,b,c);}ScopedLocalizableError.javaClass="net.sourceforge.stripes.validation.ScopedLocalizableError";ScopedLocalizableError.inherit(SimpleError);function EDAMScopedError(a,b,c){this.initialize(a,b,c);}EDAMScopedError.javaClass="com.evernote.web.EDAMScopedError";EDAMScopedError.inherit(ScopedLocalizableError);