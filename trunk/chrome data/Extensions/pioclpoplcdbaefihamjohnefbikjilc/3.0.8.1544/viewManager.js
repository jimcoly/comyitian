var ViewManager={currentView:null};ViewManager.FORM_FIELD_ERROR_CLASS="error";ViewManager.FORM_FIELD_ERROR_MESSAGE_CLASS="error";ViewManager.FORM_FIELD_ERROR_MESSAGE_ELEMENT="div";ViewManager.PAGE_HEIGHT_DELTA=0;ViewManager.SimpleMessage=function(a){this.initialize(a);};ViewManager.SimpleMessage.MESSAGE_CLASS="simpleMessage";ViewManager.SimpleMessage.prototype._container=null;ViewManager.SimpleMessage.prototype._message=null;ViewManager.SimpleMessage.prototype.initialize=function(a){this.__defineGetter__("container",this.getContainer);this.__defineGetter__("message",this.getMessage);this.__defineSetter__("message",this.setMessage);if(typeof a!="undefined"&&a){this._container=(a instanceof jQuery)?a:$(a);}};ViewManager.SimpleMessage.prototype.getContainer=function(){return this._container;};ViewManager.SimpleMessage.prototype.setMessage=function(a){this._message=a;};ViewManager.SimpleMessage.prototype.getMessage=function(){return this._message;};ViewManager.SimpleMessage.prototype.show=function(){if(this.message){var a=this.createMessageBlock();a.append(this.message);this._container.empty();this._container.append(a);}else{this._container.empty();}this._container.show();};ViewManager.SimpleMessage.prototype.hide=function(){this._container.hide();};ViewManager.SimpleMessage.prototype.createMessageBlock=function(){return $("<div class='"+this.getMessageClass()+"'></div>");};ViewManager.SimpleMessage.prototype.getMessageClass=function(){return ViewManager.SimpleMessage.MESSAGE_CLASS;};ViewManager.StackableMessage=function(a){this.initialize(a);};ViewManager.StackableMessage.MESSAGE_CLASS="stackableMessage";ViewManager.StackableMessage.inherit(ViewManager.SimpleMessage);ViewManager.StackableMessage.prototype._messageStack=new Array();ViewManager.StackableMessage.prototype.initialize=function(a){this.parent.initialize.apply(this,arguments);};ViewManager.StackableMessage.prototype.getMessage=function(){if(this._messageStack.length>0){return this._messageStack[(this._messageStack.length-1)];}else{return null;}};ViewManager.StackableMessage.prototype.setMessage=function(a){this._messageStack=new Array();this.addMessage(a);};ViewManager.StackableMessage.prototype.addMessage=function(a){this._messageStack.push(this._describeMessage(a));};ViewManager.StackableMessage.prototype.removeMessage=function(c){var a=this._describeMessage(c);for(var b=this._messageStack.length-1;b>=0;b--){if(this._messageStack[b]==a){this._messageStack.splice(b,1);break;}}};ViewManager.StackableMessage.prototype.removeAllMessages=function(){this._messageStack=new Array();};ViewManager.StackableMessage.prototype.length=function(){return this._messageStack.length;};ViewManager.StackableMessage.prototype._describeMessage=function(b){var a="";if(typeof b=="string"){a=b;}else{if(b instanceof jQuery){b.each(function(c,d){a+=this._describeMessage(d);});}else{if(b instanceof Text){a+=b;}else{if(b instanceof HTMLElement){a+=b.innerHTML;}}}}return a;};ViewManager.StackableMessage.prototype.getMessageClass=function(){return this.parent.getMessageClass()+" "+ViewManager.StackableMessage.MESSAGE_CLASS;};ViewManager.getEffectiveHeight=function(){if(typeof LOG!="undefined"){LOG.debug("ViewManager.getEffectiveHeight");}var a=0;$("body > div").each(function(c,b){var d=$(b);if(d.css("display")!="none"&&!d.hasClass("banner")&&!d.hasClass("drawer")&&!d.hasClass("drawerHandleTitle")){a+=d.innerHeight();}});a=a-ViewManager.PAGE_HEIGHT_DELTA;if(a<0){a=0;}return a;};ViewManager.updateBodyHeight=function(a){var b=(typeof a=="number")?a:ViewManager.getEffectiveHeight();$("body").animate({height:b+"px"},10);};ViewManager.showBlock=function(b,a){b.show();if(a instanceof Array){b.trigger("show",a);}else{b.trigger("show");}ViewManager.updateBodyHeight();};ViewManager.hideBlock=function(b,a){b.hide();if(a instanceof Array){b.trigger("hide",a);}else{b.trigger("hide");}ViewManager.updateBodyHeight();};ViewManager.showView=function(b,c){if(b instanceof jQuery){var a=b;}else{var a=$("#"+b);}if(a.length==0){return null;}ViewManager.showBlock(a,[c]);return a;};ViewManager.hideView=function(b){if(b instanceof jQuery){var a=b;}else{var a=$("#"+b);}if(a.length==0||a.css("display")=="none"){return null;}ViewManager.hideBlock(a);if(ViewManager.currentView&&a.attr("id")==ViewManager.currentView.attr("id")){ViewManager.currentView=null;}return a;};ViewManager.switchView=function(d,c){if(typeof LOG!="undefined"){LOG.debug("ViewManager.switchView");}var b=null;var a=(d instanceof jQuery)?d:$("#"+d);if(ViewManager.currentView&&ViewManager.currentView.attr("id")==a.attr("id")){if(typeof LOG!="undefined"){LOG.debug("Already showing...");}return;}if(ViewManager.currentView){ViewManager.hideView(ViewManager.currentView.attr("id"));}if(b=ViewManager.showView(d,c)){ViewManager.currentView=b;}return b;};ViewManager.openDrawer=function(c){var a=(c instanceof jQuery)?c:$(c);};ViewManager.closeDrawer=function(c){var a=(c instanceof jQuery)?c:$(c);};ViewManager.toggleDrawer=function(c){var a=(c instanceof jQuery)?c:$(c);};ViewManager.globalMessage=null;ViewManager.globalErrorMessage=null;ViewManager.wait=function(b){var a=$("#spinner");a.find("#spinnerMessage").html(b);a.show();};ViewManager.clearWait=function(){var a=$("#spinner");a.hide();};ViewManager.showMessage=function(a){if(ViewManager.globalMessage){ViewManager.globalMessage.addMessage(a);ViewManager.globalMessage.show();}};ViewManager.hideMessage=function(a){if(ViewManager.globalMessage){ViewManager.globalMessage.removeMessage(a);if(ViewManager.globalMessage.length()>0){ViewManager.globalMessage.show();}else{ViewManager.globalMessage.hide();}}};ViewManager.hideAllMessages=function(){if(ViewManager.globalMessage){ViewManager.globalMessage.removeAllMessages();ViewManager.globalMessage.hide();}};ViewManager.extractErrorMessage=function(b,a){if(typeof LOG!="undefined"){LOG.debug("ViewManager.extractErrorMessage");}var c=(typeof a!="undefined")?a:null;if(typeof LOG!="undefined"){LOG.debug("Error: "+b.toString());}if(b instanceof EvernoteError){if(typeof LOG!="undefined"){LOG.debug("Error is EvernoteError");}}if(b instanceof EvernoteError&&typeof b.errorCode=="number"&&typeof b.parameter=="string"&&ViewManager.getLocalizedMessage("EDAMError_"+b.errorCode+"_"+b.parameter.replace(/[^a-zA-Z0-9_]+/g,"_"))){if(typeof LOG!="undefined"){LOG.debug("Got parameterized localized message for EvernoteError");}c=ViewManager.getLocalizedMessage("EDAMError_"+b.errorCode+"_"+b.parameter.replace(/[^a-zA-Z0-9_]+/g,"_"));}else{if(b instanceof EDAMResponseException&&typeof b.errorCode=="number"&&ViewManager.getLocalizedMessage("EDAMResponseError_"+b.errorCode)){if(typeof LOG!="undefined"){LOG.debug("Got localized message for EDAMResponseException");}if(typeof b.parameter=="string"){c=ViewManager.getLocalizedMessage("EDAMResponseError_"+b.errorCode,b.parameter);}else{c=ViewManager.getLocalizedMessage("EDAMResponseError_"+b.errorCode);}}else{if(b instanceof EvernoteError&&typeof b.errorCode=="number"&&ViewManager.getLocalizedMessage("EDAMError_"+b.errorCode)){if(typeof LOG!="undefined"){LOG.debug("Got localized message for EvernoteError");}if(typeof b.parameter=="string"){c=ViewManager.getLocalizedMessage("EDAMError_"+b.errorCode,b.parameter);}else{c=ViewManager.getLocalizedMessage("EDAMError_"+b.errorCode);}}else{if(b instanceof EvernoteError&&typeof b.message=="string"){if(typeof LOG!="undefined"){LOG.debug("Resorting to message included in the error");}c=b.message;}else{if((b instanceof Error||b instanceof Error)&&typeof b.message=="string"){if(typeof LOG!="undefined"){LOG.debug("Resorting to standard message");}c=b.message;}else{if(typeof b=="string"){if(typeof LOG!="undefined"){LOG.debug("Error is a string, so using that...");}c=b;}}}}}}return c;};ViewManager.showError=function(a){if(typeof LOG!="undefined"){LOG.debug("ViewManager.showError");}var b=ViewManager.extractErrorMessage(a,ViewManager.getLocalizedMessage("UnknownError"));if(b!=null){ViewManager.globalErrorMessage.message=b;ViewManager.globalErrorMessage.show();}};ViewManager.showErrors=function(g){if(typeof LOG!="undefined"){LOG.debug("ViewManager.showErrors");}var c=(g instanceof Array)?g:[g];var b=ViewManager.getLocalizedMessage("multipleErrorsTitle");var e=$("<ul></ul>");for(var d=0;d<c.length;d++){var f=ViewManager.extractErrorMessage(g[d]);if(f!=null){e.append("<li>"+f+"</li>");}}if(e.children().length>0){var a=$("<div class='multiErrorTitle'></div>");a.append(b);a.append(e);ViewManager.globalErrorMessage.message=a;ViewManager.globalErrorMessage.show();}};ViewManager.hideError=function(){ViewManager.globalErrorMessage.hide();};ViewManager.hideErrors=function(){ViewManager.globalErrorMessage.hide();};ViewManager.showHttpError=function(c,d,a){if(typeof LOG!="undefined"){LOG.debug("ViewManager.showHttpError");}var b=ViewManager.getLocalizedMessage("Error_HTTP_Transport",[(""+c.status),((typeof a=="string")?a:"")]);ViewManager.showError(new Error(b));};ViewManager.getLocalizedMessage=function(a,b){if(typeof chrome!="undefined"&&typeof chrome.i18n.getMessage=="function"){return chrome.i18n.getMessage(a,b);}else{return a;}};ViewManager.showFormErrors=function(b,j,h){if(typeof LOG!="undefined"){LOG.debug("ViewManager.showFormErrors("+(typeof b)+", "+(typeof j)+")");}var c=(b instanceof jQuery)?b:$(b);for(var a=0;a<j.length;a++){var d=j[a];var g=ViewManager.extractErrorMessage(d);if(typeof LOG!="undefined"){LOG.debug(d.toString()+" => "+g);}if(typeof h=="function"){h(((typeof d.parameter=="string")?d.parameter:null),g);}else{if(typeof d.parameter=="string"&&g!=null){ViewManager.showFormFieldErrors(c.find("[name="+d.parameter+"]"),g);}}}};ViewManager.showFormFieldErrors=function(b,a){if(typeof LOG!="undefined"){LOG.debug("ViewManager.showFormFieldError("+b+", "+a+")");}if(typeof b=="undefined"){return;}if(!(b instanceof jQuery)){b=$(b);}if(!b.hasClass(ViewManager.FORM_FIELD_ERROR_CLASS)){b.addClass(ViewManager.FORM_FIELD_ERROR_CLASS);}if(b.next("."+ViewManager.FORM_FIELD_ERROR_MESSAGE_CLASS).length==0){b.after($("<"+ViewManager.FORM_FIELD_ERROR_MESSAGE_ELEMENT+" class='"+ViewManager.FORM_FIELD_ERROR_MESSAGE_CLASS+"'>"+a+"</"+ViewManager.FORM_FIELD_ERROR_MESSAGE_ELEMENT+">"));}else{b.next("."+ViewManager.FORM_FIELD_ERROR_MESSAGE_CLASS).html(a);}};ViewManager.clearFormArtifacts=function(a){if(typeof LOG!="undefined"){LOG.debug("ViewManager.clearFormArtifacts");}if(typeof a=="undefined"){return;}if(!(a instanceof jQuery)){a=$(a);}if(typeof LOG!="undefined"){LOG.debug("Removing error messages...");}a.find("."+ViewManager.FORM_FIELD_ERROR_MESSAGE_CLASS).remove();if(typeof LOG!="undefined"){LOG.debug("Removing error classes from fields");}a.find("."+ViewManager.FORM_FIELD_ERROR_CLASS).removeClass(ViewManager.FORM_FIELD_ERROR_CLASS);if(typeof LOG!="undefined"){LOG.debug("Done...");}};