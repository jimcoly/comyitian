var g_db=null;function opendb(){try{if(getBG().g_db_transaction_tested&&!getBG().g_db_transaction_worked){return null}if(g_db!=null){return g_db}if(window.openDatabase){g_db=openDatabase("lp","1.0","LastPass Local Database",200000);if(!g_db){console.log("Failed to open database!")}}else{console.log("open database is not available!")
}}catch(A){console.log("Caught exception while opening database: "+A.message)}return g_db}function createDataTable(A){if(A){A.transaction(function(B){B.executeSql("CREATE TABLE IF NOT EXISTS LastPassData(id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, username_hash varchar(255), type varchar(20), data TEXT, CONSTRAINT usertype UNIQUE (username_hash, type))",[],function(C,D){},function(C,D){console.log(D)
})})}}function createSavedLoginsTable(A){if(A){A.transaction(function(B){B.executeSql("CREATE TABLE IF NOT EXISTS LastPassSavedLogins(username varchar(255) PRIMARY KEY, password varchar(255), last_login datetime)",[])});A.transaction(function(B){B.executeSql("CREATE TABLE IF NOT EXISTS LastPassSavedLogins2(username varchar(255) PRIMARY KEY, password text, last_login datetime, protected tinyint(1))",[])
});A.transaction(function(B){B.executeSql("SELECT * FROM LastPassSavedLogins order by last_login desc",[],function(C,D){for(var E=0;E<D.rows.length;E++){var F=D.rows.item(E)["username"];C.executeSql("REPLACE INTO LastPassSavedLogins2 (username, password, last_login) VALUES(?, ?, ?)",[F,D.rows.item(E)["password"],D.rows.item(E)["last_login"]],function(G,H){},function(G,H){console.log(H)
});C.executeSql("DELETE FROM LastPassSavedLogins")}},function(C,D){console.log(D)})})}}function lpSaveData(C,B){if(lpdisableoffline&&(B=="key"||B=="accts"||B=="otp")){return}if(g_username==null||g_username==""){return}if(C==""&&LPISLOC&&(B=="key"||B=="accts")){return}var A=opendb();createDataTable(A);
if(A){A.transaction(function(D){D.executeSql("REPLACE INTO LastPassData (username_hash, type, data) VALUES (?, ?, ?)",[db_prepend(g_username_hash),B,C],function(E,F){},function(E,F){console.log(F)})})}}function createPrefsTable(A){if(A){A.transaction(function(B){B.executeSql("CREATE TABLE IF NOT EXISTS LastPassPreferences (id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, username_hash varchar(255), prefname varchar(255), prefvalue varchar(255), CONSTRAINT userkey UNIQUE (username_hash, prefname))",[])
})}}function deletesavedpw(){var A=opendb();createSavedLoginsTable(A);if(A){A.transaction(function(B){B.executeSql("UPDATE LastPassSavedLogins2 SET password = '' WHERE username = ?",[g_username],function(C,D){g_master_password_saved=false},function(C,D){console.log(D)})})}}function protect_data(D,C,B){if(C&&!g_is_win){return D
}var A="";if((D!=""||g_is_mac)&&have_nplastpass()&&typeof(g_nplastpass.protect_data)=="function"){A=g_nplastpass.protect_data(D,B);if(typeof(A)!="string"){A=""}}if(A==""){A=D}return A}function unprotect_data(B,A){if(A&&!g_is_win){return B}var C="";if(B!=""&&have_nplastpass()&&typeof(g_nplastpass.unprotect_data)=="function"){C=g_nplastpass.unprotect_data(B);
if(typeof(C)!="string"){C=""}}if(C==B){C=""}return C};
