var g_CS={};var g_CS_count={};var poll_timeout=1000*60;var debug=true;var g_local_key=null;var g_local_hash=null;var g_username=null;var g_username_hash=null;var g_uid=null;var g_pwdeckey=null;var g_identity="";var g_sites=new Array();var g_tlds=new Array();var g_securenotes=new Array();var g_prompts=new Array();
var g_local_accts_version=-1;var g_server_accts_version=-1;var g_identities=new Array();var g_formfills=new Array();var g_neverurls=new Array();var g_equivalentdomains=new Array();var g_urlrules=new Array();var g_pendings=new Array();var g_shareeautopushes=new Array();var g_loglogins=false;var g_launches=new Array();
var ischrome=true;var g_icons=new Array();var g_icons_length=0;var g_loggedinoffline=false;var g_loggedinonline=false;var g_notification_type=null;var g_notification_data=null;var g_site_data=null;var g_formfill_data=null;var g_reprompt_callback=null;var g_last_reprompt_time=0;var g_premium_exp=0;var g_lastpollcheck=0;
var g_lastpoll=0;var g_logoff_other_ses=false;var g_gblprefs=new Array();var g_userprefs=new Array();var g_fillfieldsmatches=new Array();var g_currenturl="";var g_currenttabid="";var g_badgedata=null;var g_saveall_url;var g_saveall_framestotal;var g_saveall_framesdone;var g_saveall_formdata;var g_genpws=new Array();
var g_lp_hotkeys=new Array("generateHk","recheckHk","searchHk","nextHk","prevHk","homeHk","submitHk","saveallHk","logoffHk","defaultffidHk");var g_generate_url="";var g_changepwnewpw="";var g_changepwtld="";var g_curr_fill_aid=0;var g_is_win=navigator.appVersion.indexOf("Windows")!=-1;var g_is_mac=navigator.appVersion.indexOf("Mac")!=-1;
var g_is_linux=navigator.appVersion.indexOf("Linux")!=-1;var g_retryonlinetimerid=null;var g_notifytimerid=null;var g_loggedLogins=new Array();var g_master_password_saved=false;var g_create_account_data=null;var g_nplastpass=null;var g_loginstarted=false;var g_persistent_notifications=new Array();var g_rejectedaddsites=new Array();
var g_checkgeneratepasswordcallback=null;var g_db_transaction_tested=false;var g_db_transaction_worked=false;var g_hidevault=false;var g_hidenotes=false;var g_hideidentities=false;var g_hideexport=false;var g_hideimport=false;var g_hidesharing=false;var g_hideprint=false;var lp_rsaprivatekeyhex="";var lp_rsaprivatekeyenchex="";
var lp_rsaprivatekeyenchexserverhash="";var g_selectedtabid=-1;function lpobjrejectedaddsite(){var D;var C;var B;var A}function have_nplastpass(A){if(!g_nplastpass){g_nplastpass=document.getElementById("nplastpass")}return typeof(g_nplastpass.alert)!="undefined"&&(A||navigator.userAgent.indexOf("Chrome/4.1.249.1042")==-1)
}function onLoad(){L("BG : loaded");if(have_nplastpass()&&typeof(g_nplastpass.file_exists)=="function"){if(g_nplastpass.file_exists("LPISLOC")){LPISLOC=true}if(g_nplastpass.file_exists("LPISUPEK")){LPISUPEK=true}}if(typeof(chrome.browserAction.setPopup)=="function"){chrome.browserAction.onClicked.addListener(function(A){open_login(true)
});drawIconAtRotation(0)}g_hidevault=get_registry_value("Software\\LastPass","hidevault","0")=="1";g_hidenotes=get_registry_value("Software\\LastPass","hidenotes","0")=="1";g_hideidentities=get_registry_value("Software\\LastPass","hideidentities","0")=="1";g_hideexport=get_registry_value("Software\\LastPass","hideexport","0")=="1";
g_hideimport=get_registry_value("Software\\LastPass","hideimport","0")=="1";g_hidesharing=get_registry_value("Software\\LastPass","hidesharing","0")=="1";g_hideprint=get_registry_value("Software\\LastPass","hideprint","0")=="1";if(LPISLOC){g_hideidentities=g_hidesharing=g_hideprint=true}lpReadAllPrefs(function(A){if(A==0){lpPutGblPref("welcomedone",1);
lpWriteAllPrefs();if(!LPISLOC){openURL(getchromeurl("welcome.html"))}}if(lpGetPref("enablenamedpipes",1)==1&&have_nplastpass()){lpnp_init()}if(LPISLOC||!g_np_init){httptest()}});setup_poll_timer();if(getchromeurl("needtoreinstall.html").indexOf("kegdhfdpgckamaoikbjiemmikleploeh")!=-1){openURL(base_url+"/needtoreinstall.html")
}}chrome.extension.onConnect.addListener(function(A){var B=false;if(A.name==A.tab.url){g_CS[A.tab.id]=new Array();g_CS_count[A.tab.id]=0;g_loggedLogins=new Array();B=true}L("CS["+A.tab.id+"] -> BG : CONNECT from tab with url="+A.tab.url);if(typeof(g_CS[A.tab.id])=="undefined"||!g_CS[A.tab.id]){g_CS[A.tab.id]=new Array();
g_CS_count[A.tab.id]=0}var C=g_CS[A.tab.id].length;g_CS[A.tab.id][C]=A;g_CS_count[A.tab.id]++;sendCS(A.tab.id,{cmd:"setdocnum",docnum:C},C);if(B){if(typeof(g_persistent_notifications[A.tab.id])!="undefined"&&g_persistent_notifications[A.tab.id]){sendCS(A.tab.id,g_persistent_notifications[A.tab.id])}}A.onMessage.addListener(function(E,D){receiveCS(D.tab.id,E,0,A)
});A.onDisconnect.addListener(function(D){receiveCS(D.tab.id,null,1,A)})});function disconnectCS(A){if(typeof(g_CS[A])!="undefined"&&g_CS[A]){for(var B=0;B<g_CS[A].length;B++){g_CS[A][B].disconnect();g_CS[A][B]=null}g_CS_count[A]=0}}function sendCS(B,F,G){if(B=="all"){for(var E in g_CS){for(var C=0;C<g_CS[B].length;
C++){sendCS(E[C],F)}}return}if(typeof(g_CS[B])=="undefined"||!g_CS[B]){L("BG -> CS["+B+"] : FAILED");return}var D=0,A=0;if(typeof(G)!="undefined"){if(G=="all"){A=g_CS[B].length-1}else{if(G<g_CS[B].length){D=A=G}}}for(var E=D;E<=A;E++){g_CS[B][E].postMessage(F)}}function receiveCS(A,D,C,B){if(C){if(--g_CS_count[A]<=0){g_CS[A]=null
}return}if(typeof(D.cmd)=="undefined"){L("CS["+A+"] -> BG : INVALIDMSG");return}if(!processCS(A,D,B)){L("CS["+A+"] -> BG : INVALIDMSG")}}function sendTS(E,D){try{if(E.cmd=="notification"&&E.type!="upgrade"){set_badge(E)}if(E.cmd!="notification"||E.type!="upgrade"){return}var G=typeof(D)=="undefined"?"all":D;
var C=false;var A=chrome.extension.getViews();for(var B in A){if(typeof(A[B].receiveBG)=="function"&&(G=="all"||(typeof(A[B].g_toolstripid)!="undefined"&&G==A[B].g_toolstripid))){L("BG -> TS : cmd="+E.cmd);A[B].receiveBG(E);C=true;if(G!="all"){break}}}if(!C){L("BG -> TS : FAILED")}}catch(F){L("BG -> TS : FAILED error="+F)
}}function set_badge(A){chrome.browserAction.setBadgeText({text:"1"});g_badgedata=A;currrotation=0;animateFlip()}function clear_badge(){chrome.browserAction.setBadgeText({text:""});currrotation=numrotations;g_badgedata=null;drawIconAtRotation(0)}function receiveTS(B,A){if(typeof(A.cmd)=="undefined"){L("TS["+B+"] -> BG : INVALIDMSG");
return null}L("TS["+B+"] -> BG : cmd="+A.cmd);switch(A.cmd){case"getloginstate":if(lploggedin){sendTS({cmd:"login"},B)}break;case"sesameauth":sesame_auth(A.otp,A.label);break;case"yubikeyauth":yubikey_auth(A.otp,A.label);break;case"gridauth":grid_auth(A.gridvalues,A.label);break;case"multifactorauth":multifactor_auth(["multifactorresponse"],A.label);
break;case"lostkey":lostkey();break;case"sesamelostkey":sesamelostkey();break;case"gridlostkey":gridlostkey();break;case"multifactorlostkey":multifactorlostkey(A.type);break;case"turnofficon":lpTurnOffIcon();break;default:L("TS["+g_toolstripid+"] -> BG : INVALIDMSG");return null;break}}function processCS(A,H,C){switch(H.cmd){case"plug2web":if(lp_url_is_lastpass(H.url)){var E=lpParseUri(H.url)
}var I=E.directory;var D=E.file;I=I.replace(new RegExp("^/~[^/]*"),"");if(I!=""&&I!="/"&&I!="/sso/"&&I!="/sso/webroot/"&&I!="/sso/aso/"){lpdbg("error","Keyplug2web request from invalid directory: "+I);break}D=D.replace(new RegExp("#"),"");if(D!=""&&D!="index.php"&&D!="import.php"&&D!="export.php"&&D!="otp.php"&&D!="frameset.php"&&D!="frame_login.php"&&D!="gettopost.php"&&D!="webrootaso.html"&&D!="misc_challenge.php"&&D!="enterprise_users.php"){lpdbg("error","Keyplug2web request from invalid file: "+D);
break}if(g_username!=null&&g_username!=""){if(H.username&&H.username!=""&&fix_username(H.username)!=fix_username(g_username)){loggedOut()}else{sendCS(A,{cmd:"plug2web",username:g_username,key:AES.bin2hex(g_local_key),version:lpversion,identity:g_identity},H.docnum)}}break;case"web2plug":if(lp_url_is_lastpass(H.url)){web2plug(H)
}break;case"logoff":if(lp_url_is_lastpass(H.url)){if(lploggedin){loggedOut()}}break;case"login":if(lp_url_is_lastpass(H.url)){loginfromwebsite(H)}break;case"fill":case"autofillaid":case"autologinaid":H.topurl=C.tab.url;handleFill(A,H);break;case"checkgenpwfillforms":checkgenpwfillforms(A,H.url);break;
case"neverautofill":case"neverpage":case"neverdomain":handleNever(A,H);if(typeof(H.fromsave)!="undefined"){g_persistent_notifications[A]=null;var G=H.notificationdata["username"];var N=H.notificationdata["password"];lpAddRejectedSite(G,N,H.tld);clear_badge()}break;case"clearnotification":clear_badge();
g_persistent_notifications[A]=null;break;case"notnow":var G=H.notificationdata["username"];var N=H.notificationdata["password"];lpAddRejectedSite(G,N,H.tld);g_persistent_notifications[A]=null;clear_badge();break;case"savethesite":var K=H.notificationdata;K.addsite=1;g_site_data=K;chrome.tabs.create({url:getchromeurl("site.html")});
g_persistent_notifications[A]=null;clear_badge();break;case"changepw":var K=H.notificationdata;if(K.sitecount==1){changePassword(K.newpw,new Array(K.singleaid))}else{openchangepw(K.newpw,K.tld)}g_persistent_notifications[A]=null;clear_badge();break;case"save":handleSave(A,H);break;case"updatefields":handleUpdateFields(A,H);
break;case"saveall":g_saveall_formdata+=H.formdata;if(++g_saveall_framesdone>=g_saveall_framestotal){handleSaveAll(A,{cmd:"saveall",addsite:1,url:g_saveall_url,formdata:g_saveall_formdata})}console.log(g_saveall_framesdone+"|"+g_saveall_framestotal);break;case"clearcache":if(lp_url_is_lastpass(H.url)){clearCache(true,false,false)
}break;case"recover":console.log("username in bg "+H.username);if(lp_url_is_lastpass(H.url)){recover(A,H.url,H.username,H.docnum)}break;case"launchautologin":if(lp_url_is_lastpass(H.url)){launchautologin(H.aid)}break;case"getprefs":setprefs(A,H.docnum);break;case"getuuid":sendCS(A,{cmd:"setuuid",uuid:getuuid()},H.docnum);
break;case"setupmultifactor":H.tabid=A;if(H.username==g_username){var M="type="+LP.en(H.type)+"&username="+LP.en(H.username);lpMakeRequest(base_url+"setupmultifactor.php",M,lpSetupMultifactorResponse,function(){lpSetupMultifactorError(H)},H)}else{sendCS(A,{cmd:"setupmultifactor",result:"error"},H.docnum)
}break;case"setupsinglefactor":H.tabid=A;if(H.username==g_username){var M="type="+LP.en(H.type)+"&username="+LP.en(H.username);lpMakeRequest(base_url+"setupmultifactor.php",M,lpSetupMultifactorResponse,function(){lpSetupMultifactorError(H)},H)}else{if(H.silent!="1"){sendCS(A,{cmd:"setupsinglefactor",result:"error"},H.docnum)
}}break;case"checkmultifactorsupport":var J="";var O="error";if(have_nplastpass()&&typeof(g_nplastpass.trueapi_supported)=="function"&&g_nplastpass.trueapi_supported()){J="trueapi";O="done"}else{if(have_nplastpass()&&typeof(g_nplastpass.lpvt_supported)=="function"&&g_nplastpass.lpvt_supported()){J="vtapi";
O="done"}}sendCS(A,{cmd:"checkmultifactorsupport",type:J,result:O},H.docnum);break;case"multifactorauth":var B="";if(H.type=="trueapi"){var F=SHA256(SHA256(fix_username(H.username)+H.type));if(F.length!=64){if(have_nplastpass()&&typeof(g_nplastpass.trueapi_get_hash)=="function"){F=g_nplastpass.trueapi_get_hash(H.username)
}}if(F!=""){B=SHA256(F+H.challenge)}}var O=B!=""?"done":"error";sendCS(A,{cmd:"multifactorauth",multifactorresponse:B,result:O},H.docnum);break;case"refresh":if(lp_url_is_lastpass(H.url)){if(H.from=="settings"){lplogincheck(H.type=="2"?"websiterefreshrsa":"websiterefresh")}else{get_accts()}}break;case"switchidentity":if(lp_url_is_lastpass(H.url)){switch_identity(H.iid,true,true)
}break;case"fillfieldconfirm":fillfieldsconfirm(H);break;case"deleteaid":deleteAid(H.aid,null,true,true);break;case"runhotkey":switch(H.hotkey){case"generateHk":opengenpw();break;case"recheckHk":recheckpage();break;case"searchHk":opensearch();break;case"nextHk":fillnext(1);break;case"prevHk":fillnext(-1);
break;case"homeHk":openvault();break;case"submitHk":fillnext(0,true);break;case"saveallHk":saveall();break;case"logoffHk":loggedOut();break;case"defaultffidHk":fill_default_ffid();break}break;case"fillformffid":fillform(H.ffid);break;case"addprofile":addprofile();break;case"addcreditcard":addcreditcard();
break;case"clearforms":clearforms();break;case"chooseprofilecc":openchooseprofilecc();break;case"generate":opengenpw();break;case"fillcurrentaid":fillcurrent(H.aid);break;case"generatepasswordfound":if(g_checkgeneratepasswordcallback){g_checkgeneratepasswordcallback();g_checkgeneratepasswordcallback=null
}break;case"log":console.log(H.msg);break;default:L("CS["+A+"] -> BG : INVALIDMSG");return false;break}return true}function open_login(F){var C=lpGetPref("singlefactortype","");if(C=="trueapi"&&have_nplastpass()&&typeof(g_nplastpass.trueapi_default_login_exists)=="function"&&g_nplastpass.trueapi_default_login_exists()){var H={},B={},E={};
if(g_nplastpass.trueapi_get_default_login(H,B,E)){multifactor_setdata("password_offline",E.value);multifactor_setdata("type",C);LP_do_login(H.value,B.value,false,false,true);return}}if(LPISUPEK||C=="vtapi"){if(have_nplastpass()&&typeof(g_nplastpass.lpvt_verify_user)=="function"){var A=encodeURIComponent(lpCreatePass(8,1,1,1,0,1,0,1));
var D=g_nplastpass.lpvt_verify_user(A,gs("Swipe finger"),gs("Swipe your finger on the fingerprint sensor"),gs("Cancel"));if(D!=""){var G=D.split("|");if(G.length==2){LP_do_login(decodeURIComponent(G[0]),decodeURIComponent(G[1]));return}}}if(LPISUPEK&&LPISLOC){lpshowError("LoginError",false,true);return
}}if(F){chrome.windows.getAll({populate:true},function(M){for(var K=0;K<M.length;K++){for(var J=0;J<M[K].tabs.length;J++){var I=M[K].tabs[J].url;if(I&&lp_url_is_lastpassext(I)&&I.indexOf("login.html")!=-1){chrome.tabs.remove(M[K].tabs[J].id)}}}chrome.tabs.getSelected(null,function(N){g_selectedtabid=N.id
});chrome.tabs.create({url:getchromeurl("login.html")})})}else{openURL(getchromeurl("login.html"))}}function fillnext(B,A){if(!lploggedin){open_login();return}chrome.tabs.getSelected(null,function(D){getBG().setcurrenttabid(D.id);getBG().setcurrenturl(D.url);var E=getmatchingsites();if(E.length>0){for(var C=0;
C<E.length;C++){if(E[C].aid==g_curr_fill_aid){break}}if(C==E.length){g_curr_fill_aid=B==-1?E[E.length-1].aid:E[0].aid}else{if(B==1){if(++C>=E.length){C=0}}else{if(B==-1){if(--C<0){C=E.length-1}}}g_curr_fill_aid=E[C].aid}if(A){fill(g_currenttabid,g_sites[g_curr_fill_aid],null,true,false,"all",false,false,true)
}else{fillaid(g_curr_fill_aid)}}})}function getInt(A){var B=parseInt(A);if(B==""||B==NaN){B=0}return B}function loggedIn(B){L("BG : loggedIn");lploggedin=true;lpReadAllPrefs(postlogin);var C=localStorage.getItem(db_prepend("lastversion"));checkOpenUpgradePage(C);localStorage.setItem(db_prepend("lastversion"),lpversion);
var A=opendb();createSavedLoginsTable(A);if(A){A.transaction(function(D){D.executeSql("SELECT * FROM LastPassSavedLogins2 WHERE username = ? AND password != ''",[g_username],function(E,F){if(F.rows.length>0){g_master_password_saved=true}},function(E,F){})})}if(B){setTimeout("refresh_windows();",500)}drawIconAtRotation(0);
sendTS({cmd:"login"})}function checkOpenUpgradePage(A){var K=A;var I=lpversion;var F=0,C=0,B=0;var J=0,G=0,M=0;if(K){var D=K.split(".");for(var E=0;E<D.length;E++){if(E==0){F=parseInt(D[E])}else{if(E==1){C=parseInt(D[E])}else{if(E==2){B=parseInt(D[E])}}}}}var H=I.split(".");for(var E=0;E<H.length;E++){if(E==0){J=parseInt(H[E])
}else{if(E==1){G=parseInt(H[E])}else{if(E==2){M=parseInt(H[E])}}}}if((K&&K!="null")&&(J>F||G>C)){openURL(base_url+"upgrade.php?ver="+lpversion+"&type=cr&upgrade="+K)}}function postlogin(){var A=(new Date()).getTime();g_lastpollcheck=A;if(lpGetPref("logoffWhenCloseBrowser",0)==1&&lpGetPref("logoffWhenCloseBrowserVal",0)>0){lpPutUserPref("lastpollcheck",g_lastpollcheck);
lpWriteAllPrefs()}}function lplogoff(){loggedOut()}function lplogoff_if(){if(lploggedin){loggedOut()}}var rotation=0;var numrotations=14*36;var currrotation=0;function animateFlip(){rotation+=1/36;if(rotation>=1){rotation-=1}if(++currrotation>=numrotations){rotation=0}else{setTimeout("animateFlip()",10)
}drawIconAtRotation(rotation)}function drawIconAtRotation(F){var E;if(g_badgedata!=null){if(g_badgedata.cmd=="notification"&&g_badgedata.type=="save"){E="icon_green"}else{E="icon_yellow"}}else{if(lploggedin){E="icon"}else{E="icon_gray"}}var C=document.getElementById(E);var D=18;var B=18;var A=document.getElementById("canvas").getContext("2d");
A.save();A.clearRect(0,0,D+1,B+1);A.translate(D/2,B/2);A.rotate(2*Math.PI*ease(F));A.drawImage(C,-C.width/2,-C.height/2);A.restore();chrome.browserAction.setIcon({imageData:A.getImageData(0,0,D+1,B+1)});if(typeof(chrome.browserAction.setPopup)=="function"){chrome.browserAction.setPopup({popup:lploggedin||g_badgedata!=null?"lp_toolstrip.html?browseraction=1":""})
}}function ease(A){return(1-Math.sin(Math.PI/2+A*Math.PI))/2}function lpAddRejectedSite(D,B,A){var C=new lpobjrejectedaddsite();C.username=D;C.encryptedPassword=lpenc(B);C.tld=A;C.rejectedTime=lp_get_gmt_timestamp();g_rejectedaddsites[g_rejectedaddsites.length]=C}function loggedOut(A){L("BG : loggedOut");
chrome.windows.getAll({populate:true},function(F){for(var E=0;E<F.length;E++){for(var D=0;D<F[E].tabs.length;D++){var C=F[E].tabs[D].url;if(C&&lp_url_is_lastpassext(C)&&C.indexOf("homelocal.html")==-1){chrome.tabs.remove(F[E].tabs[D].id)}}}});if(lploggedin){lpnp_notify("logout")}closeallnotifications();
yubikey_cleardata();sesame_cleardata();grid_cleardata();multifactor_cleardata();lpSaveData("","key");var B=false;if(!lploggedin){A=true;B=true}lploggedin=false;g_local_key=null;g_local_hash=null;g_username=null;g_username_hash=null;g_uid=lpuid=null;g_pwdeckey=null;g_sites=new Array();g_tlds=new Array();
g_securenotes=new Array();g_prompts=new Array();g_icons=new Array();g_icons_length=0;g_local_accts_version=-1;g_server_accts_version=-1;g_identities=new Array();g_pendings=new Array();g_shareeautopushes=new Array();g_formfills=new Array();g_neverurls=new Array();g_equivalentdomains=new Array();g_urlrules=new Array();
g_loglogins=false;g_launches=new Array();g_fillfieldsmatches=new Array();g_loggedinoffline=false;g_loggedinonline=false;lp_phpsessid="";g_premium_exp=0;g_loginstarted=false;lpReadAllPrefs();rotation=0;drawIconAtRotation();if(g_badgedata!=null&&(g_badgedata.cmd!="notification"||g_badgedata.type!="error")){clear_badge()
}rsa_clearvars();rsa_setpendingsharests(true);g_genpws=new Array();g_master_password_saved=false;g_persistent_notifications=new Array();g_rejectedaddsites=new Array();lpdisableoffline=false;countryfromip="";sendTS({cmd:"logoff"});if(!B){setTimeout("refresh_windows();",500)}if(!A){lpMakeRequest(base_url+"logout.php?chrome_plugin=1&noredirect=1","",null,null)
}}function getmenurowheight(){return 20}function getmatchingsitesheight(B){var A=B.length*getmenurowheight();if(A>200){A=200}return A}function getmenuheight(E,C,D,F){var B=15;if(g_premium_exp>0){--B}var H=getmenurowheight();var A=B*H;if(typeof(E)=="undefined"||E){var G=getmatchingsites();if(G.length>0){A+=H;
A+=getmatchingsitesheight(G)}}if(typeof(C)=="undefined"||C){A+=5+1+1+2+23}if(typeof(D)=="undefined"||D){A+=15}if(F){A-=50}return A}function fillaid(B,C){var A=C?true:false;fill(g_currenttabid,g_sites[B],null,false,true,"all",true,A,true)}function setcurrenturl(A){g_currenturl=A}function setcurrenttabid(A){g_currenttabid=A
}function getmatchingsites(){var C=g_currenturl;var B=lp_gettld_url(C);var A=getsites(B);A=reorderOnURL(A,C);var D;var F;var G;var E=[];for(D in A){F=A[D]["aid"];if(typeof(g_sites[F])=="undefined"){continue}G=g_sites[F];E.push({aid:G.aid,name:G.name,username:getusernamefromacct(G),fiid:G.fiid})}return E
}function getnevers(){var B=g_currenturl;var A=lp_gettld_url(B);var C=lpcanonizeUrl(B);var D=[];getneverfor(D,"neveraccounts",C,A);getneverfor(D,"neverautologins",C,A);getneverfor(D,"neverformfills",C,A);getneverfor(D,"nevergenerates",C,A);return D}function getneverfor(E,F,D,A){if(g_neverurls[F]&&g_neverurls[F].length>0){for(var C=0;
g_neverurls[F]&&C<g_neverurls[F].length;C++){var B=g_neverurls[F][C];if(B==D){E.push({type:F,url:B,domain:0})}else{if(B==A){E.push({type:F,url:B,domain:1})}}}}}function getusernamefromacct(B){if(B.save_all){for(var A=0;A<B.fields.length;A++){if(B.fields[A].type=="text"&&B.fields[A].value!=""){return lpmdec(B.fields[A].value,true)
}}return""}else{return typeof(B.unencryptedUsername)!="undefined"?B.unencryptedUsername:""}}function getpasswordfromacct(B){if(B.save_all){for(var A=0;A<B.fields.length;A++){if(B.fields[A].type=="password"&&B.fields[A].value!=""){return lpmdec(B.fields[A].value,true)}}return""}else{return typeof(B.password)!="undefined"?lpmdec(B.password,true):""
}}function accthaspassword(B){if(B.save_all){for(var A=0;A<B.fields.length;A++){if(B.fields[A].type=="password"&&B.fields[A].value!=""){return true}}return false}else{return B.password!=""}}function getsites(E,G){var C;if(typeof(g_equivalentdomains[E])!="undefined"){var B=g_equivalentdomains[E];if(typeof(g_equivalentdomains[B])!="undefined"){C=g_equivalentdomains[B]
}}else{C=new Array(E)}var A=new Array();for(var F=0;F<C.length;F++){if(typeof(g_tlds[C[F]])!="undefined"){for(var D in g_tlds[C[F]]){if(G&&g_sites[D]["genpw"]){continue}A[D]=g_tlds[C[F]][D]}}}return A}function lp_url_is_lastpass(A){if(A.indexOf(base_url)==0||A.indexOf("https://lastpass.com/")==0){return true
}else{return false}}function lp_url_is_lastpassext(A){var B=getchromeurl("");if(A&&A.indexOf(B)==0){return true}return false}function openvault(A){if(!lploggedin){open_login();return}if(A){chrome.windows.getAll({populate:true},function(D){for(var C=0;C<D.length;C++){for(var B=0;B<D[C].tabs.length;B++){if(D[C].tabs[B].url==getchromeurl("homelocal.html")){return
}}}openURL(getchromeurl("homelocal.html"))})}else{openURL(getchromeurl("homelocal.html"))}}function openimport(){openURL(base_url+"import.php?hasplugin="+LP.en(lpversion)+get_identity_param())}function openimportchrome(){openURL(getchromeurl("import.html"))}function openexport(){openURL(getchromeurl("export.html"))
}function openprint(B){var A=base_url+"export.php?plug=1&print=1&hasplugin="+LP.en(lpversion)+get_identity_param();if(B){A+="&notes=1"}openURL(A)}g_pref_tab=null;function openprefs(A){if(A){g_pref_tab=A}chrome.tabs.getSelected(null,function(B){g_selectedtabid=B.id});openURL(getchromeurl("prefs.html"))
}function openhelp(){openURL(base_url+"help.php?fromwebsite=1")}function openpremium(){openURL(base_url+"premium.php")}function openall(D,F){if(D==gs("favorites")){openfavorites()}else{if(D==gs("recently usedlower")){openallrecent()}else{var C=new Array();var A=false;for(var B in g_sites){if(!check_ident_aid(g_sites[B]["aid"])){continue
}if(g_sites[B]["group"]==D){C.push(g_sites[B]);A|=g_sites[B]["pwprotect"]}}if(C.length==0){return}if(!F&&(A||g_prompts.login_site_prompt)){security_prompt(function(){openall(D,true)});return}for(var B=0;B<C.length;B++){var E=C[B];openURL(E.url,function(G,H){console.log("setting aid "+G.id+" "+H);g_launches[G.id]=H
},E.aid,true)}}}}function openallrecent(F){var D=new Array();for(var C in g_sites){if(!check_ident_aid(g_sites[C]["aid"])){continue}D.push(g_sites[C])}D.sort(function(H,G){return H.last_touch>G.last_touch?1:-1});var A=new Array();var B=false;for(var C=0;A.length<10&&C<D.length;C++){if(D[D.length-C-1].url=="http://group"){continue
}B|=D[D.length-C-1]["pwprotect"];A[A.length]=D[D.length-C-1]}if(A.length==0){return}if(!F&&(B||g_prompts.login_site_prompt)){security_prompt(function(){openallrecent(true)});return}for(var C=0;C<A.length;C++){var E=A[C];openURL(E.url,function(G,H){console.log("setting aid "+G.id+" "+H);g_launches[G.id]=H
},E.aid,true)}}function openfavorites(E){var C=new Array();var A=false;for(var B in g_sites){if(!check_ident_aid(g_sites[B]["aid"])){continue}if(g_sites[B]["fav"]=="1"){C.push(g_sites[B]);A|=g_sites[B]["pwprotect"]}}if(C.length==0){return}if(!E&&(A||g_prompts.login_site_prompt)){security_prompt(function(){openfavorites(true)
});return}for(var B=0;B<C.length;B++){var D=C[B];openURL(D.url,function(F,G){console.log("setting aid "+F.id+" "+G);g_launches[F.id]=G},D.aid,true)}}function saveall(){if(!lploggedin){open_login();return}chrome.tabs.getSelected(null,function(A){g_saveall_url=A.url;g_saveall_framestotal=g_CS_count[A.id];
g_saveall_framesdone=0;g_saveall_formdata="";sendCS(A.id,{cmd:"saveall"},"all")})}function openfeedback(){openURL(base_url+"feedback.php")}function opengenpw(){chrome.tabs.getSelected(null,function(A){g_generate_url=A.url;openURL(getchromeurl("lp_toolstrip.html?browseraction=1&generate=1&tabid="+en(A.id)))
})}function openchooseprofilecc(){chrome.tabs.getSelected(null,function(B){var A=B.id;openURL(getchromeurl("lp_toolstrip.html?browseraction=1&chooseprofilecc=1&tabid="+en(A)))})}function openchangepw(B,A){g_changepwnewpw=B;g_changepwtld=A;openURL(getchromeurl("lp_toolstrip.html?browseraction=1&changepw=1"))
}function opensearch(){if(!lploggedin){open_login();return}openURL(getchromeurl("home.html"))}function recheckpage(){if(!lploggedin){open_login();return}chrome.tabs.getSelected(null,function(B){var A=B.id;sendCS(A,{cmd:"recheck"},"all")})}function refreshsites(){get_accts()}function clearAllData(){var A=opendb();
createDataTable(A);if(A){A.transaction(function(B){var C=LPISLOC?" WHERE type != 'key' AND type != 'accts'":"";B.executeSql("DELETE FROM LastPassData"+C,[],function(D,E){console.log("DESTROYING LastPassDatang Table")},function(D,E){console.log(E)})})}}function clearCache(F,B,E){if(typeof(B)=="undefined"){B=true
}if(typeof(E)=="undefined"){E=true}if(g_username==null||g_username==""){return}if(!LPISLOC){localStorage.removeItem(db_prepend(g_username_hash+"_lt.cac"));if(have_nplastpass()&&typeof(g_nplastpass.delete_file)=="function"){g_nplastpass.delete_file(db_prepend(g_username_hash)+"_lt.cac");g_nplastpass.delete_file(db_prepend(g_username_hash)+"_lpall.slps");
g_nplastpass.delete_file(db_prepend(g_username_hash)+"_lpall.lps")}}var D="";if(!B){D+=" AND type != 'icons' AND type != 'rsakey'"}if(!E){D+=" AND type != 'otp'"}if(!LPISLOC){D+=" AND type != 'key' AND type != 'accts'"}var C=opendb();createDataTable(C);if(C){C.transaction(function(H){H.executeSql("UPDATE LastPassData SET username_hash=? WHERE username_hash=?"+D,["deleteme",db_prepend(g_username_hash)],function(I,K){var J=opendb();
createDataTable(J);if(J){J.transaction(function(M){M.executeSql("DELETE FROM LastPassData WHERE username_hash=?"+D,["deleteme"],function(N,O){},function(N,O){console.log(O)})})}},function(I,J){console.log(J)})})}if(B){var A=lpreadretry();if(A!=null&&A!=""){var G=gs("A retry file has been found. This likely means that not all of your site changes have been saved. Would you like to delete this file and potentially lose some changes?");
if(F||confirm(G)){lpdeleteretry()}}}}function openabout(){openURL(getchromeurl("about.html"))}function opensessions(){openURL(base_url+"sess.php")}function openseccheck(){openURL(base_url+"?securitychallenge=1")}function openaddsite(){g_site_data=createNewAcct();chrome.tabs.getSelected(null,function(A){g_site_data.url=A.url;
g_site_data.addsite="1";g_site_data.noreplace="1";openURL(getchromeurl("site.html"))})}function openaddsecurenote(){if(!lploggedin){open_login(1);return}g_site_data=createNewAcct();g_site_data.sn=1;g_site_data.url="http://sn";openURL(getchromeurl("site.html"))}function checkforupdates(){g_notification_type="upgrade";
g_notification_data={checking:true};sendTS({cmd:"notification",type:"upgrade"});setTimeout(function(){lpMakeRequest(base_url+"upgrade.php?binary="+(have_nplastpass()?1:0)+"&x=1&ver="+LP.en(lpversion),"",upgrade_response,null)},250)}function fillform(C,F,B,D){if(!check_ident_ffid(C)){return}if(D&&!check_ident_ffid(D)){return
}for(var E=0;E<g_formfills.length;E++){if(g_formfills[E]["ffid"]==C){break}}if(E==g_formfills.length){return}var A;if(D){for(A=0;A<g_formfills.length;A++){if(g_formfills[A]["ffid"]==D){break}}if(A==g_formfills.length){return}}if(!F&&(g_formfills[E]["pwprotect"]||(D&&g_formfills[A]["pwprotect"])||g_prompts.view_ff_prompt)){chrome.tabs.getSelected(null,function(H){var G=B?B:H.id;
security_prompt(function(){fillform(C,true,G,D)})});return}chrome.tabs.getSelected(null,function(I){var G=B?B:I.id;var J=g_formfills[E];var H=D?g_formfills[A]:null;var P=new Array();for(var O in J){if(O=="ffid"||O=="profiletype"||O=="pwprotect"){P[O]=J[O]}else{if(O=="custom_fields"){P[O]=new Array();
for(var M=0;M<J[O].length;M++){var K="custom_field"+M;P[K]=new Array();P[K]["cfid"]=J[O][M]["cfid"];P[K]["text"]=lpmdec(J[O][M]["text"],true);P[K]["value"]=lpmdec(J[O][M]["value"],true);P[K]["alttext"]=lpmdec(J[O][M]["alttext"],true)}}else{if(D&&O.indexOf("cc")==0){P[O]=lpmdec(H[O],true)}else{P[O]=lpmdec(J[O],true)
}}}}var N=JSON.stringify(P);console.log(N);sendCS(G,{cmd:"fillform",toformfill:N},"all");logformfill(C)})}function fillcurrent(B,C,A){if(!C&&(g_sites[B]["pwprotect"]||g_prompts.login_site_prompt)){chrome.tabs.getSelected(null,function(E){var D=A?A:E.id;security_prompt(function(){fillcurrent(B,true,D)
})});return}chrome.tabs.getSelected(null,function(E){var D=A?A:E.id;sendCS(D,{cmd:"fillcurrent",password:getpasswordfromacct(g_sites[B])},"all")})}function openbaseurl(A){openURL(base_url+A)}function addprofile(){if(!lploggedin){open_login(1);return}g_formfill_data={};g_formfill_data.cmd="add";g_formfill_data.type=0;
g_formfill_data.data=null;openURL(getchromeurl("formfill.html"))}function addcreditcard(){if(!lploggedin){open_login(1);return}g_formfill_data={};g_formfill_data.cmd="add";g_formfill_data.type=1;g_formfill_data.data=null;openURL(getchromeurl("formfill.html"))}function editprofile(A,C){if(!lploggedin){open_login(1);
return}for(var B=0;B<g_formfills.length;++B){if(A==g_formfills[B].ffid){if(!C&&g_formfills[B]["pwprotect"]){security_prompt(function(){editprofile(A,true)});return}g_formfill_data={};g_formfill_data.cmd="edit";g_formfill_data.type=g_formfills[B]["profiletype"];g_formfill_data.data=g_formfills[B];openURL(getchromeurl("formfill.html"));
break}}}function clearforms(){chrome.tabs.getSelected(null,function(B){var A=B.id;sendCS(A,{cmd:"clearforms"},"all")})}function lostkey(){openURL(base_url+"lostkey.php?cmd=sendemail&username="+en(g_username))}function sesamelostkey(){openURL(base_url+"sesamedisable.php?cmd=sendemail&username="+en(g_username))
}function gridlostkey(){openURL(base_url+"griddisable.php?cmd=sendemail&username="+en(g_username))}function multifactorlostkey(A){openURL(base_url+"multifaactordisable.php?cmd=sendemail&username="+en(g_username)+"&type="+en(A))}function geticonurl(D,C){var B="data:image/gif;base64,R0lGODlhEAAQAIcAAAAAAExnf1BpgWR0iHZ6hHeBkX+GkYiOmpeaopucoaSlqqWmqrm9w7q+xL+/wry/xcXGyc3Oz9HS1NPU1tnZ2d/h4+Di5OLj5uPl5+Tk5OXm6O7u7+7v8O/w8e/w8vDw8fHx8vLy8/Pz8/Pz9PT09fX19fX29vb29vf39/f3+Pj4+Pj4+fn5+vr6+/v7/Pz8/P39/f7+/v///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAAQABAAAAiQAAEIHEiw4MAFCBEmQCjBIIAFMiLK8CBjA4QIBiFu2Fgh4oYJDgpq5Chxw4KCCiqSlKigIAKVGyowYNDgAYGCB2BWsHABgwYDBQvA/CCiBAoVBQoOUNlBhAkVLV4MKCigIgenK1zAiCGgYICKIEhAhRExgFcZHEKcYEG27NkOI1K0aCvDLMEAePPqteuwr8CAADs=";
var A="data:image/gif;base64,R0lGODlhEAAQAPfBAFdCGCpgtyxity1kuS5kuS5luS9lujBlujBmujFmuzFnuzNpvIdhK4JmLjZvvzhxvzt2wTt2xKZoJjx4wT98xUB8xEKAxUKAxkWCxUWCxkeExkmFxEmIxkqIxkuIxWCFrUuJxUuJxkyJxr56Gk2LyE+Lx0+MyE+MyU+NyKqJQ8mFQWWU27yJTMKMSMeMSMWYSWWo0siZZLOfcNqYSduZS9CdRk+y99iaVFGy99mbUVW0+NOfZuChUdejY32y4tilWGG8+2K8/GK9/GO9+2C+/Ge9/GS+/GW++2i//W7C/duxhb+2ptW2etG3kNa5dprJ4+e+d+fAi8zGsMzGs+TJVcLLtpPU/8nNr5TV/+3KbefLd5XW//nHlPnJke3QeM3S2tDUvrjW9O7TebrW9fDTecjV4u7UffHUe9XWve7Vgc3W4fLWeu/SrPDStMHb+PbTrvXcXvXcX8Lc+MTd+fXfW/bdbPffY8Xf+ffhWsfg+sjg+ffiW8jg+8ng+/jiXcjh+8nh+8rh+sni+8vi+83j+83j/Onf0s7j+8/j/M/k/NDk+9Hk/PHjr9Xl/tPm/Nfm8tTm/NTm/fzgxPnjstPn/dXn/dbn/dbn/tfn/tbo/tfo/tjo/tzq9t7q9t7r9t/r9d/s9+Pt9+bw9+jx+Orx+Ory+uvy+Ozy9+zy+Ovz+uzz+e3z+O30+O30+e70+O/0+f/y4PD0+f32wv32xPH1+f/z5f33x/L2+vL3+/P3/PT3+/T4/PX5/Pf6/fj7/fj7//3+/v///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////yH5BAEKAP8ALAAAAAAQABAAAAj+AP/9I2GioAkUJ0qAiCCw4YZTrlitmojq1CMfKxr+83ArDyBBfO64CfOryg8lNQSKoFXoEKFBeuSMYQSlTS02Lv6FoIVIUaJCgeZcSTMpyhtJO3TGcgSJ0iJCYMzMqpOlRwyBHV5hslQpEhoxtuLsWcPjg0AOrTZt0iRFiy04eM7QMJRBoAZVmTRNcSLLjh8yM8qUuiAQg6lLS5g0oULHSw41gHBREGhhVKMUsG6MeNHiS58/vSAIrCBKRwMuXVRIgIHDhg1eDgROCJUEAAMWMp5swWLliC4FAh98QlLkiBEjQoYAIRLE1wCBC0iB8tSJE6dUqUrl2gUsQMMDCRAMiD9goEABAgQECAwIADs=";
if(D!=null){if(typeof(g_icons[D+".gif"])!="undefined"){B="data:image/gif;base64,"+g_icons[D+".gif"]}else{if(typeof(g_icons[D+".ico"])!="undefined"){B="data:image/ico;base64,"+g_icons[D+".ico"]}else{if(C){B=A}}}}return B}function geticonhtml(B,A){return"<image src='"+geticonurl(B,A)+"'/>"}function lpshowError(E,C,A,B,D){g_notification_type="error";
g_notification_data={msg:gs(E),showFeedback:C,showLogin:A,showCreateAccount:B,multifactor_disable_url:D};sendTS({cmd:"notification",type:"error"});console.log(E)}function launch(C,E){if(!check_ident_aid(C)){return}var D=null;if(g_sites[C]){D=g_sites[C]}else{if(g_securenotes[C]){return editAid(C)}else{return
}}var A=D.pwprotect;if(!E&&(A||g_prompts.login_site_prompt)){security_prompt(function(){launch(C,true)});return}var B=D.url;if(!B.match(/^[a-z]+?\:\/\//i)){B="http://"+B}openURL(B,function(F,G){g_launches[F.id]=G},D.aid)}function security_prompt(H){if(g_prompts.multifactor_reprompt||LPISUPEK){var F=multifactor_getdata("password_offline");
if(F&&F!=""){var C=multifactor_getdata("type");if(C=="trueapi"){if(have_nplastpass()&&typeof(g_nplastpass.trueapi_get_hash)=="function"){var A=g_nplastpass.trueapi_get_hash(g_username);if(A==F){H();return}}}}var B=lpGetPref("singlefactortype","");if(LPISUPEK||B=="vtapi"){if(have_nplastpass()&&typeof(g_nplastpass.lpvt_verify_user)=="function"){var E=g_nplastpass.lpvt_verify_user("",gs("Swipe finger"),gs("Swipe your finger on the fingerprint sensor"),gs("Cancel"));
if(E!=""){var G=E.split("|");if(G.length==2){if(g_local_key!=""&&g_local_key==AES.hex2bin(SHA256(fix_username(decodeURIComponent(G[0]))+decodeURIComponent(G[1])))){H();return}}}}if(LPISUPEK&&LPISLOC){return}}}var D=lpGetPref("reprompttime",0);if((new Date()).getTime()-g_last_reprompt_time<=D*1000){H()
}else{g_reprompt_callback=H;chrome.tabs.getSelected(null,function(I){g_selectedtabid=I.id});openURL(getchromeurl("login.html"))}}function get_identity_param(){return"&iid="+LP.en(g_identity)}function add_ident_aid(C){if(g_identity==""){return}else{for(var A=0;A<g_identities.length;A++){if(g_identities[A].iid==g_identity){break
}}if(A>=g_identities.length){return}var B=g_identities[A];if(B.aids!=""){B.aids+=","}B.aids+=C;B.aidarr=B.aids.split(",")}}function add_ident_ffid(A){if(g_identity==""){return}else{for(var B=0;B<g_identities.length;B++){if(g_identities[B].iid==g_identity){break}}if(B>=g_identities.length){return}var C=g_identities[B];
if(C.ffids!=""){C.ffids+=","}C.ffids+=A;C.ffidarr=C.ffids.split(",")}}function check_ident_aid(C){if(g_identity==""){return true}else{for(var A=0;A<g_identities.length;A++){if(g_identities[A].iid==g_identity){break}}if(A>=g_identities.length){return false}var B=g_identities[A];if(typeof(B.aidarr)=="undefined"){B.aidarr=B.aids.split(",")
}return lp_in_array(C,B.aidarr)}}function check_ident_ffid(A){if(g_identity==""){return true}else{for(var B=0;B<g_identities.length;B++){if(g_identities[B].iid==g_identity){break}}if(B>=g_identities.length){return false}var C=g_identities[B];if(typeof(C.ffidarr)=="undefined"){C.ffidarr=C.ffids.split(",")
}return lp_in_array(A,C.ffidarr)}}function switch_identity(D,F,E,C){if(D==g_identity){return}var A=false;if(D!=""){for(var B=0;B<g_identities.length;B++){if(g_identities[B].iid==D){if(g_identities[B].pw_prompt){A=true}break}}if(B>=g_identities.length){return}}if(!F&&(A||g_prompts.switch_identity_prompt)){security_prompt(function(){switch_identity(D,true)
});return}g_identity=""+D;if(!C){lpnp_notify("switchidentity",{data0:g_identity})}lpPutUserPref("identity",g_identity);lpWriteAllPrefs();if(!E){refresh_windows()}}function add_identity(){openURL(base_url+"?ac=1&addidentity=1")}function setup_poll_timer(){setTimeout("poll_server();",60000)}function set_last_reprompt_time(){g_last_reprompt_time=(new Date()).getTime()
}function compare_tlds(B,A){if(typeof(B)!="string"){return false}if(typeof(A)!="string"){return false}B=B.toLowerCase();A=A.toLowerCase();if(B==A){return true}else{if(typeof(g_equivalentdomains[B])!="undefined"&&typeof(g_equivalentdomains[A])!="undefined"&&g_equivalentdomains[B]==g_equivalentdomains[A]){return true
}else{return false}}}var LP=this;function mostRecent(){return window}function currentWindow(){return window}function en(A){return encodeURIComponent(A)}function lpprefsHasUserValue(A,B){return B}function lpprefsGetBoolPref(A,B){return B}function lpprefsGetIntPref(A,B){return B}function lpreadretry(){var A=localStorage.getItem(db_prepend(g_username_hash+".retry"));
return A}function lpdeleteretry(){localStorage.removeItem(db_prepend(g_username_hash+".retry"))}function lpwriteretry(A){if(g_username_hash==""||g_username_hash==null){return false}localStorage.setItem(db_prepend(g_username_hash+".retry"),A);return true}function getuuid(){if(LPISLOC){return""}try{var C=localStorage.getItem(db_prepend("lp.uid"));
if(C==null||C==""){if(g_is_win&&have_nplastpass()&&typeof(g_nplastpass.read_file)=="function"){C=g_nplastpass.read_file(db_prepend("lp.suid"));if(C==null||C==""){C=g_nplastpass.read_file(db_prepend("lp.uid"));if(C!=null&&C!=""){var A=protect_data(C,true);g_nplastpass.write_file(db_prepend("lp.suid"),A)
}}else{C=unprotect_data(C,true)}}if(C==null||C==""){C=lpCreatePass(32,1,1,1,1,1,1,1);localStorage.setItem(db_prepend("lp.uid"),C);if(g_is_win&&have_nplastpass()&&typeof(g_nplastpass.write_file)=="function"){var A=protect_data(C,true);g_nplastpass.write_file(db_prepend("lp.suid"),A)}}}return C}catch(B){console.log("Error in getuuid: "+B);
return""}}function lpdbg(B,A){console.log(A)}var lperrorcount=0;function lpReportError(D,B){var E=D;if(g_prompts.improve==false){return}lperrorcount++;if(lperrorcount>100){return}var A=E.match(/^(.*)location:\s+/);if(A){E=A[1]}var C="msg=cr() lp("+lpversion+") errors("+lperrorcount+"): "+LP.en(E);lpMakeRequest(base_url+"error.php?",C,null,null)
}function lplog(A){console.log(A)}function lpatob(A){return atob(A)}function lpbtoa(A){return btoa(A)}function lpGetCurrentWindow(){return window}function bin2hex(A){return AES.bin2hex(A)}function hex2bin(A){return AES.hex2bin(A)}function openURL(B,E,A,C){if(!E){E=function(F){}}var D=lpGetPref("openpref","tabs");
if(D=="same"&&(C||B.indexOf("chrome-extension://")==0)){D="tabs"}if(D=="same"){chrome.tabs.getSelected(null,function(F){if(F.url.match(/^https?:\/\/.*\//)){sendCS(F.id,{cmd:"loadurl",url:B});E(F,A)}else{chrome.tabs.create({url:B},function(G){E(G,A)})}})}else{if(D=="windows"){chrome.windows.create({url:B},function(F){E(F,A)
})}else{chrome.tabs.create({url:B},function(F){E(F,A)})}}}function copyusername(A){Clipboard.copy(getusernamefromacct(g_sites[A]))}function copypassword(A,C){var B=g_sites[A];if(B.sharedfromaid!=null&&B.sharedfromaid!=""&&B.sharedfromaid!="0"&&B.sharedfromaid!="null"){alert(gs("This is a shared site. You are not permitted to view the password."));
return}if(!C&&(B.pwprotect||g_prompts.view_pw_prompt)){security_prompt(function(){copypassword(A,true)});return}Clipboard.copy(getpasswordfromacct(B))}function refresh_windows(){chrome.windows.getAll({populate:true},function(D){for(var C=0;C<D.length;C++){for(var B=0;B<D[C].tabs.length;B++){if(lp_url_is_lastpass(D[C].tabs[B].url)&&D[C].tabs[B].url.indexOf("lpnorefresh=1")==-1){var A=D[C].tabs[B].url;
A=A.replace("&nk=1","");sendCS(D[C].tabs[B].id,{cmd:"loadurl",url:A})}}}})}function closeallnotifications(){chrome.windows.getAll({populate:true},function(C){for(var B=0;B<C.length;B++){for(var A=0;A<C[B].tabs.length;A++){sendCS(C[B].tabs[A].id,{cmd:"closenotification"})}}})}function recheckall(){chrome.windows.getAll({populate:true},function(C){for(var B=0;
B<C.length;B++){for(var A=0;A<C[B].tabs.length;A++){sendCS(C[B].tabs[A].id,{cmd:"recheck"},"all")}}});setprefs("all","all")}function closecurrenttab(){chrome.tabs.getSelected(null,function(A){chrome.tabs.remove(A.id)})}function fill_default_ffid(){var B=lpGetPref("defaultffid","0");for(var A=0;A<g_formfills.length;
A++){if(g_formfills[A].ffid==B){fillform(B);return}}if(confirm(gs("You have not yet chosen a default form fill profile.  Would you like to choose one now?"))){openprefs()}}function setprefs(B,K){var O=getInt(lpGetPref("highlightFields",1));var M=getInt(lpGetPref("warninsecureforms",0));var G=getInt(lpGetPref("dontfillautocompleteoff",0));
var F=getInt(lpGetPref("donotoverwritefilledfields",0));var E=getInt(lpGetPref("showGenerateNotifications",1));var C=getInt(lpGetPref("showFormFillNotifications",1));var J=getInt(lpGetPref("showNotificationsAfterClick",1));var N=getInt(lpGetPref("alwayschooseprofilecc",0));var A=getInt(lpGetPref("automaticallyFill",1));
var I={cmd:"setprefs",highlightFields:O,warninsecureforms:M,dontfillautocompleteoff:G,donotoverwritefilledfields:F,showGenerateNotifications:E,showFormFillNotifications:C,showNotificationsAfterClick:J,alwayschooseprofilecc:N,automaticallyFill:A};for(var H=0;H<g_lp_hotkeys.length;H++){var D=g_lp_hotkeys[H];
I[D+"KeyCode"]=lpGetPref(D+"KeyCode");I[D+"Mods"]=lpGetPref(D+"Mods")}if(B=="all"){chrome.windows.getAll({populate:true},function(R){for(var Q=0;Q<R.length;Q++){for(var P=0;P<R[Q].tabs.length;P++){sendCS(R[Q].tabs[P].id,I,"all")}}})}else{sendCS(B,I,K)}}function get_registry_value(D,A,C){var B=C;if(g_is_win&&have_nplastpass()&&typeof(g_nplastpass.get_registry_value)=="function"){B=g_nplastpass.get_registry_value(D,A,C);
if(typeof(B)!="string"){B=C}}return B}function gotourl(B){var C=null;if(g_sites[B]){C=g_sites[B]}else{if(g_securenotes[B]){return editAid(B)}else{return}}var A=C.url;if(!A.match(/^[a-z]+?\:\/\//i)){A="http://"+A}openURL(A)}function deleteNever(F){var D=new Array();for(var C=0;g_neverurls[F.type]&&C<g_neverurls[F.type].length;
C++){var B=g_neverurls[F.type][C];if(B!=F.url){D.push(B)}}g_neverurls[F.type]=D;g_local_accts_version++;rewritelocalfile();var E=0;switch(F.type){case"nevergenerates":E=1;break;case"neverformfills":E=2;break;case"neverautologins":E=3;break}var A="delete=1&type="+LP.en(E)+"&url="+LP.en(F.url);lpMakeRequest(base_url+"add_never.php",A,function(){},function(){},null)
}function db_prepend(A){if(LPISLOC){A="local_"+A}return A}function changemasterpassword(){if(LPISLOC){openURL(getchromeurl("changemasterpw.html"))}else{openbaseurl("?ac=1&opensettings=1")}}function change_master_password(G,J,E){var I=make_lp_key(G,J);var C=[],B=[],A=[],H=[];if(!getBG().reencrypt(C,getBG().g_sites,I)||!getBG().reencrypt(B,getBG().g_securenotes,I)||!getBG().reencrypt(A,getBG().g_formfills,I)){alert(gs("An error occurred"));
return}if(E){var F=getBG().g_local_key;getBG().g_local_key=I;var D=flattendata(g_local_accts_version+1,C,B,g_prompts,A,g_identities,g_equivalentdomains,g_neverurls,g_premium_exp,lpenc(G),g_pendings,g_shareeautopushes,lpmaxid,g_urlrules);getBG().g_local_key=F;return D}else{getBG().g_sites=C;getBG().g_securenotes=B;
getBG().g_formfills=A;getBG().g_local_accts_version++;getBG().g_local_hash=make_lp_hash(G,J);getBG().g_local_key=make_lp_key(G,J);getBG().g_username=G;getBG().g_username_hash=SHA256(G);getBG().rewritelocalfile(false,true);getBG().g_pwdeckey=getBG().g_local_key;getBG().lpWriteKeyFile();getBG().lpnp_notify("local_pwchange",{data0:g_username,data1:J});
alert(gs("Password updated!"));getBG().closecurrenttab()}}function reencrypt(E,D,B){for(var C in D){var A=[];if(!reencryptArray(A,D[C],B,false)){return false}E[C]=A}return true}var keystoreencrypt=["username","password","extra","profilename","firstname","middlename","lastname","email","company","ssn","birthday","address1","address2","city","state","state_name","zip","country","country_cc3l","country_name","mobilephone","mobilephone3lcc","mobileext","evephone","evephone3lcc","eveext","phone","phone3lcc","phoneext","fax","fax3lcc","faxext","ccnum","ccexp","cccsc","address3","title","gender","driverslicensenum","taxid","bankname","bankacctnum","bankroutingnum","timezone","county","ccstart","ccname","ccissuenum","notes","text","alttext","profilelanguage"];
function reencryptArray(C,H,I,J){try{for(var E in H){if(typeof(H[E])=="object"){var F=[];var B=E=="custom_fields"?2:(J||E=="fields");if(!reencryptArray(F,H[E],I,B)){return false}C[E]=F}else{if(lp_in_array(E,keystoreencrypt)||(E=="value"&&(J==2||(J&&fieldisencrypted(H))))){var D=(lpmdec(H[E],true));if((D==null||D=="")&&(H[E]!=null&&H[E]!="")){return false
}var A=lpmenc(D,true,I);C[E]=A}else{C[E]=H[E]}}}}catch(G){console.error(G);return false}return true}function fieldisencrypted(A){for(var B in A){if(B=="type"&&(A[B]=="password"||A[B]=="text"||A[B]=="hidden"||A[B]=="textarea")){return true}}return false}var lpclearrecent=false;function clearrecent(){localStorage.setItem(g_username_hash+"recent",lp_get_gmt_timestamp());
lpclearrecent=true}function getClearRecentTime(){var A=localStorage.getItem(g_username_hash+"recent");if(A==null){return 0}return A}function IsIconsUpdated(A){if(lpclearrecent){lpclearrecent=false;return true}return g_icons_length!=A}function upgradetoserver(){security_prompt(function(){openURL(getchromeurl("welcome.html"))
})};
