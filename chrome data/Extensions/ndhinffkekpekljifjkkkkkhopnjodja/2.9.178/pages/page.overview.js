(function(){var a=devhd.pkg("pages");var c=devhd.i18n.L;var b=devhd.log.get("page.overview");a.OverviewPage=function(e){this.guid=e};var d=a.OverviewPage.prototype=new a.BasePage();d.service=function(f,e){this.pageInfo=f;this.width=e.width;if(this.pageInfo.uri=="latest"){this.categoryLabel="#latest"}else{this.categoryLabel=this.pageInfo.key}if(this.categoryLabel==null){$debug("[feedly][error] invalid category key:"+this.pageInfo.key+". Context: "+this.pageInfo.uri);
this.categoryLabel="#latest"}this.title=this.reader.formatTitle(this.categoryLabel);this.initBase(e);this.startRenderHTML()};d.destroy=function(g,f){this.waitingDisplayQueue=[];if(this.topArea!=null){this.topArea.destroy();this.topArea=null}this.subscriptions=null;this.feedLocationIndex=null;this.displayedSubscriptionIndex=null;this.pageModel=null;if(this.controls!=null){for(var e=0;
e<this.controls.length;e++){this.controls[e].destroy()}}this.controls=null;this.destroyBase()};d.allowsSideArea=function(){return false};d.allowsPageHeader=function(){return true};d.showCustomizer=function(e){this.showListCustomizer(e.target)};d.startRenderHTML=function(){this._cancelAllVisualFinders();this.state="loading";this.subscriptions=this.trends.listRankedSubscriptions(this.categoryLabel,this.hideReadArticlesFilter());
this.subscriptions=this.subscriptions.slice(0,100);this.feedly.clearNbrPages();this.feedly.selectTab(this.categoryLabel);this.feedly.pushContext({uri:this.pageInfo.uri,pageNumber:0,title:this.title,level:1,category:this.categoryLabel,subscriptions:[]});this.feedly.setOptionsContent("");this.feedly.setPageTitle(templates.page.overview.title(this.reader.formatTitle(this.categoryLabel)));
var e=5;if(this.subscriptions.length<5){e=7}if(this.subscriptions.length<9){e=4}else{e=3}this.pageElem.innerHTML=templates.page.overview.layout(this.reader.formatTitle(this.categoryLabel),this.subscriptions,e,this.width,this.home);for(var f=0;f<this.subscriptions.length;f++){this.askFeedEntries(this.subscriptions[f].id,e)}this.updatePageTitleHint()};
d.askFeedEntries=function(g,e){if(this.reader==null){return}var i=this.reader.lookupSubscription(g);var f=i==null||i.unreadCount==null?-1:i.unreadCount;if(this.hideReadArticlesFilter()==false){var h=this;this.reader.askEntries(g,{xt:this.hideReadArticlesFilter()?"read":null},Math.min(e,f),function(j){h.onEntriesReady(g,j)},function(k,j){h.onEntriesError(g,k,j)
})}else{var h=this;this.reco.askFeedDigest(g,Math.min(e,f),function(j){h.onEntriesReady(g,j)},function(k,j){h.onEntriesError(g,k,j)})}};d.updatePageTitleHint=function(){var e=this.element("pageTitleHint");if(e!=null){e.innerHTML=templates.page.overview.pageTitleHint(this.categoryLabel,this.reader.getCategoryUnreadCount(this.categoryLabel),this.home)
}};d.determinePageNumber=function(e){if(e<=2){return 0}else{return 1+Math.floor((e-2)/3)}};d.onEntriesReady=function(f,e){if(this.isDestroyed()){return}this.displayEntries(f,e)};d.onEntriesError=function(e,h,f){var g=this.element("main_"+e+"_entries");if(g!=null){g.innerHTML=h+" -- "+f}};d.displayEntries=function(g,o){try{var k=[];for(var m=0;m<o.length;
m++){var q=this.reader.lookupEntry(o[m]);k.push({entry:q,type:15})}if(k.length>0){var p=this.element("main_"+g+"_entries");p.innerHTML=templates.page.base.parts(k,(this.width-34)/3,{includeSourceTitle:false},this.home);for(var l=0;l<k.length;l++){this.askFindVisual(k[l].entry,"U15")}}}catch(n){var h=devhd.utils.ExceptionUtils.formatError("display articles",n);
$debug("[overview]"+h);var f=this.element("main_"+g+"_entries");f.innerHTML=h}};d.markAsRead=function(){this.markCategoryAsRead(this.categoryLabel)};d.onSubscriptionAdded=function(f,e,g){if(g==true){return}this.feedly.reloadPage()};d.onSubscriptionRemoved=function(e){if(this.pageModel.index[e]==null){return}this.feedly.reloadPage({forceRecreate:false,disableAutoMarkAsRead:true})
};d.markPageAsRead=function(){this.signs.setMessage(c(295),100);var e=this;this.home.getDocument().defaultView.setTimeout(function(){if(e.topArea!=null){e.topArea.markAllAsRead()}for(var g=0;g<e.pageModel.parts.length;g++){var h=e.pageModel.parts[g];if(h.entries!=null&&h.entries.length>0){for(var f=0;f<h.entries.length;f++){e.reader.markEntryAsRead(h.entries[f].getId())
}}}},15)};d.onSubscriptionMarkedAsRead=function(e){if(this.element("main_"+e)==null){return}this.effects.fade(this.element("main_"+e),{delay:1,from:1,to:0,onComplete:function(f){devhd.utils.HTMLUtils.remove(f)}},"feedly");this.state="loaded"};d.findNextEntryId=function(m){var l=false;if(this.selectedEntryId==null){l=true}if(this.topArea!=null){var e=this.topArea.findNextEntyId(this.selectedEntryId,m);
if(e===true){l=true}else{if(e!=null){return e}}}for(var k=0;k<this.pageModel.parts.length;k++){var n=this.pageModel.parts[k];if(n.entries!=null&&n.entries.length>0){for(var g=0;g<n.entries.length;g++){if(l==true){if(m==true){var h=n.entries[g].getId();var f=this.reader.lookupEntry(h);if(f.isRead()==false){return h}else{continue}}else{return n.entries[g].getId()
}}if(n.entries[g].getId()==this.selectedEntryId){l=true}}}}return null};d.onNextEntry=function(g,e){var f=this.findNextEntryId(g);if(f!=null){if(e==true){this.selectEntry(f,"toview")}else{this.inlineEntry(f,true)}}else{if(this.isFullyLoaded()==true){this.feedly.loadNextPage({selectEntry:true,navigationMode:"keyboard"})}else{this.signs.setMessage(c(105))
}}};d.findPreviousEntryId=function(m){var l=false;if(this.selectedEntryId==null){l=true}for(var k=this.pageModel.parts.length-1;k>=0;k--){var n=this.pageModel.parts[k];if(n.entries!=null&&n.entries.length>0){for(var g=n.entries.length-1;g>=0;g--){if(l==true){if(m==true){var h=n.entries[g].getId();var f=this.reader.lookupEntry(h);if(f.isRead()==false){return h
}else{continue}}else{return n.entries[g].getId()}}if(n.entries[g].getId()==this.selectedEntryId){l=true}}}}if(this.topArea!=null){var e=this.topArea.findPreviousEntyId(l==true?null:this.selectedEntryId,m);if(e!==true&&e!==false){return e}}};d.onPreviousEntry=function(g,e){var f=this.findPreviousEntryId(g);if(f!=null){if(e==true){this.selectEntry(f,"toview")
}else{this.inlineEntry(f,true)}}else{this.feedly.loadPreviousPage({selectEntry:true,navigationMode:"keyboard"})}};d.onCategoryUnreadCountChanged=function(e,f,g){if(this.categoryLabel!=e&&this.categoryLabel!="#latest"){return}if(g==true){return}this.updatePageTitleHint()};d.onNewEntriesAvailable=function(f,g,e){if(this.feedly==null){return}}})();