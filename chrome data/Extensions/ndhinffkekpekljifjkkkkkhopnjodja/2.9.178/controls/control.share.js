(function(){var d=devhd.pkg("control");var a=d.BaseControl.prototype;var e=d.createClass("ShareControl",d.BaseControl);var c=devhd.i18n.L;var b=devhd.log.get("control.share");e.setReader=function(f){this.reader=f};e.setAnnotator=function(f){this.annotator=f};e.setEntry=function(f){this.entry=f};e.destroy=function(){this.reader=null;this.annotator=null;
this.shareNoteElem=null;this.panelShareElem=null;this.panelSendingElem=null;a.destroy.call(this)};e.display=function(){this.part.innerHTML=templates.control.share.form();this.shareNoteElem=this.element("shareNote");this.panelShareElem=this.element("panelShare");this.panelSendingElem=this.element("panelSending");this.bind("shareCancelAction","click",e.cancelIt);
this.bind("shareSendAction","click",e.sendIt);this.bind(this.part,"keydown",e.dispatchKeys);this.reset()};e.sendIt=function(){var h=this;this.showSending();var g=this.getModel("note");if(g==null){g={linkify:false,share:true,snippet:templates.control.share.snippet(this.entry,[]),srcTitle:this.entry.getSourceTitle(),srcUrl:this.entry.getSourceAlternateLink(),tags:[],title:this.entry.getCleanTitle(),url:this.entry.getAlternateLink()}
}if(this.entry!=null){g.entryId=this.entry.getId()}g.annotation=this.getNote();this.reader.askCreateNote(g,function(){h.fire("onControlDoneSending",c(138))},function(j,k){h.showPanel();h.setMessage(c(c(273),"Share Note",j,k))});try{var f={type:"google.share",userId:this.home.getUserId(),note:this.getNote(),feedId:this.entry.getFeedId()};this.annotator.askSaveMarkersForEntry(this.entry,[f])
}catch(i){b.error(125,"save annotation ",i)}};e.cancelIt=function(){this.fire("onControlDoneSending")};e.dispatchKeys=function(f){if(f.keyCode==27){devhd.events.cancelEvent(f);this.cancelIt();return}if((f.keyCode==77&&f.ctrlKey)||(f.keyCode==13&&(f.metaKey||f.ctrlKey))){devhd.events.cancelEvent(f);this.sendIt();return}};e.reset=function(){if(this.shareNoteElem==null){return
}this.showPanel();this.shareNoteElem.focus()};e.showPanel=function(){this.panelSendingElem.style.display="none";this.panelShareElem.style.display="block"};e.showSending=function(){this.panelSendingElem.style.display="block";this.panelShareElem.style.display="none"};e.getNote=function(){return devhd.str.trim(this.shareNoteElem.value)}})();